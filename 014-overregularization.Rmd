---
output:
  pdf_document: default
  html_document: default
---
# Morphological Overgeneralization {#overregularization}

Although Chapter \@ref(grammar) examined broad patterns of morphosyntactic development in relation to vocabulary size, we did not conduct specific analyses of the development of morphology *per se*. In this brief chapter, we rectify that omission by examining patterns of morphology in two cases, plural noun morphology and past tense verb morphology. These two morphological systems are well-studied in the literature because plural (e.g., *cats*) and past tense forms (e.g., *walked*) are some of the earliest to be produced by young children [@brown1973]. Moreover, plural and past tense forms are viewed as a window into the mechanisms underlying productive language use because children will sometimes make overgeneralization errors, such as *tooths* or *goed*. The developmental time course of children's overgeneralization errors has been an influential case study for language learning -- and mental representation more broadly [@rumelhart1986;@pinker1988;@pinker1991;@elman1996]. We begin by describing cross-sectional patterns of overgeneralization across languages and then turn to characterizing longitudinal change in overgeneralization in two languages which have different morphological systems, English and Norwegian. 

## Introduction and Methods

```{r overreg-data, eval=FALSE}
grammar_items <- read_csv("data/overregularization/overreg_item_coding.csv")
overreg_items <- grammar_items %>%
  filter(group == "overregularized") %>%
  select(language, form, item_id, num_item_id, type, definition, lexical_category, stem)

get_overreg_data <- function(lang, lang_items) {
  print(lang)
  lang_admins <- admins %>% filter(language == lang, form == "WS")
  lang_data <- get_instrument_data(language = lang,
                                   form = "WS",
                                   items = lang_items$item_id,
                                   iteminfo = lang_items,
                                   administrations = lang_admins)
  
  lang_data %>%
    mutate(produces = !is.na(value) & value == "produces") %>%
    select(language, item_id, type, definition, 
           data_id, original_id, longitudinal, age, production, produces)
}

overreg_data <- overreg_items %>%
  mutate(lang = language) %>%
  nest(items = -lang) %>%
  mutate(data = map2(lang, items, get_overreg_data))

overreg_data_items <- overreg_data %>%
  select(-items) %>%
  unnest(cols = c(data)) %>%
  select(-lang) %>%
  left_join(overreg_items)

feather::write_feather(overreg_data_items, "data/overregularization/_overreg_data_items.feather")
```

```{r overreg-by_kid, eval=FALSE}
overreg_data_items <- feather::read_feather("data/overregularization/_overreg_data_items.feather")

form_words <- items %>%
  filter(form == "WS", type == "word") %>%
  group_by(language) %>%
  summarise(num_words = n())

overreg_by_kid <- overreg_data_items %>%
  group_by(language, type, lexical_category,
           data_id, original_id, longitudinal, age, production) %>%
  summarise(total = n(), num_true = sum(produces),
            num_false = total - num_true, prop = num_true / total) %>%
  ungroup() %>%
  left_join(form_words) %>%
  mutate(production_prop = production / num_words,
         lexical_category = as_factor(lexical_category))

overreg_by_item <- overreg_data_items %>%
  group_by(language, type, lexical_category, item_id, definition) %>%
  summarise(total = n(), num_true = sum(produces),
            num_false = total - num_true, prop = num_true / total) %>%
  ungroup()

feather::write_feather(overreg_by_kid, "data/overregularization/overreg_by_kid.feather")
feather::write_feather(overreg_by_item, "data/overregularization/overreg_by_item.feather")
```

```{r overreg-load}
overreg_by_kid <- feather::read_feather("data/overregularization/overreg_by_kid.feather")
overreg_by_item <- feather::read_feather("data/overregularization/overreg_by_item.feather")

overreg_by_kid_cross <- overreg_by_kid %>%
  group_by(language, original_id) %>%
  filter(age == min(age)) %>%
  ungroup()

overreg_by_kid_nonzero <- overreg_by_kid_cross %>% filter(prop != 0)

by_kid_summary <- overreg_by_kid_cross %>%
  group_by(language, lexical_category) %>%
  summarise(mean = mean(prop),
            n = n()) %>%
  mutate(group = "all")

non_zero_summary <- overreg_by_kid_nonzero %>%
  group_by(language, lexical_category) %>%
  summarise(mean = mean(prop),
            n = n()) %>%
  mutate(group = "non_zero")

by_item_summary <- overreg_by_item %>%
  select(language, lexical_category, definition, prop) %>%
  group_by(language, lexical_category) %>%
  mutate(direction = case_when(prop == min(prop) ~ "min", prop == max(prop) ~ "max", TRUE ~ "")) %>%
  filter(!(direction == "")) %>%
  group_by(language, lexical_category, direction) %>%
  sample_n(1) %>%
  mutate(definition = str_remove(definition, " \\(.*\\)"))
```

```{r overreg-fits}
vocab_model <- function(inst_data) {
  lm(prop ~ #I(production_prop ^ 4) + I(production_prop ^ 3) +
       I(production_prop ^ 2) + production_prop + 0, data = inst_data)
}

vocab_models <- overreg_by_kid_nonzero %>%
  group_by(language, lexical_category) %>%
  nest() %>%
  mutate(
    model = map(data, vocab_model),
    rsq = map_dbl(model, ~summary(.x)$adj.r.squared),
    rsq_print = glue("r² = {roundp(rsq)}")
    # rsq_print = glue("italic(r)^2 == {sprintf('%.2f', round(rsq, 2))}")
  )

vocab_step <- 0.01
vocabs <- tibble(production_prop = seq(0, 1, vocab_step))
vocab_fits <- vocab_models %>%
  mutate(fits = map(model, ~broom::augment(., newdata = vocabs))) %>%
  select(-data, -model) %>%
  unnest(cols = c(fits))


age_model <- function(inst_data) {
  lm(prop ~ #I(age ^ 4) + I(age ^ 3) +
       I(age ^ 2) + age, data = inst_data)
}

age_models <- overreg_by_kid_nonzero %>%
  nest(data = c(-language, -lexical_category)) %>%
  mutate(
    model = map(data, age_model),
    rsq = map_dbl(model, ~abs(summary(.x)$adj.r.squared)),
    # rsq_print = glue("r² = {sprintf('%.2f', round(rsq, 2))}")
    rsq_print = glue("r² = {roundp(rsq)}")
  )
ages <- overreg_by_kid_nonzero %>%
  distinct(language, lexical_category, age) %>%
  nest(data = age)
age_fits <- age_models %>%
  select(-data) %>%
  left_join(ages) %>%
  mutate(fits = map2(model, data, ~broom::augment(.x, newdata = .y))) %>%
  select(-data, -model) %>%
  unnest(cols = c(fits))
```

When a child gleefully says *Mommy, I brushed my tooths!*, a proud parent might rejoice in their child's accomplishment. At the same time, they might worry because the child has *overgeneralized* the regular plural -s inflection to an irregular form (*teeth*). Overgeneralization errors are not uncommon in child speech, although like all aspects of early language development, there is considerable variation across children in how many errors children make [@marcus1992;@maratsos1993]. Importantly, overgeneralization errors have been viewed as a positive sign that the child has abstracted the regularities of their language (e.g., add -s to indicate there is more than one thing) and applied that regularity in a productive way (i.e., the child has not likely heard the adult use that form).

The developmental timeline of generalization has been investigated extensively for the English plural and past tense. One classic study in child language [@berko1958] explored children's ability to be productive with plural and past tense forms in an elicitation task using novel forms (e.g., *Here is a wug! Now there are two of them -- there are two wugs!*). Other classic studies using naturalistic designs [@cazden1968;@brown1973] noted that correct irregular forms often appear early in development, alongside correctly inflected forms. Only later in development are overgeneralizations produced, *after* children have been successful in producing the correct irregular form, apparently unlearning what they already knew. With further development, overgeneralizations are less likely to occur -- although they are still more difficult for children with language disorders [@marchman1999] and sometimes produced by adults [especially under stressed conditions; @mcdonald2010]. 

The particular mechanisms underlying this developmental timeline have been subject to considerable debate in the literature [@marcus1992;@elman1996]. A particular focus of interest has been the so-called "U-shaped" developmental pattern (correct irregular -- overgeneralization -- correct irregular) . On one view, the onset of overgeneralizations after correct productions may signify a grammatical rule coming "online," after a period in which correctly inflected forms were learned by rote [@pinker1998]. Alternatively, the onset of overgeneralization errors may be the consequence of an accumulation of lexical exemplars from which children extract the general patterns [@marchman1994;@plunkett1989]. Each of these views, as well as those in between, make different predictions about the universal nature of the U-shaped pattern, both across children and across individual noun or verb forms, as well as the sources of variability that might influence the developmental time course of this pattern. 

This debate has become a case study for understanding the representational formats which form the foundation for human learning and generalization [@pinker1998]. Yet few studies have had the opportunity to explore patterns of the onset of overgeneralization errors in large datasets like those available in Wordbank. Moreover, most of the publishe work in this debate came from English. For a broader view, it is critical to begin to evaluate patterns of overgeneralization errors crosslinguistically, given that morphological systems vary widely across languages [@marcus1995;@clahsen1992]. 

Here we explore the consistency and variability timecourse of children's use of plural and past tense overgeneralizations using CDI data from the English and Norwegian samples. Our approach here depends on the fact that the original developers of the CDI were interested in this debate and included overregularizations as options in the morphological sections of the form. For example, an item like *foot* includes *foots* and *feet* as possible options to be checked. To take advantage of this, we coded overgeneralizations on each of the `r length(unique(overreg_by_kid$language))` WS-type forms for which we had access to data from these items (two from English dialects). We then used this coding to count the total proportion overregularizations by child, both overall and within noun and verb categories. We first show analyses of these overregularizations for cross-sectional data, and then present more in-depth analyses of longitudinal data in English and Norwegian.

## Cross-Sectional Data

We begin by describing overregularization within the cross-sectional data. For any dataset with longitudinal administrations, we we include only the earliest administration for each child. We then compute the proportion of nouns and verbs that each child is reported to overregularize. The mean proportion of overregularizations (Table \@ref(tab:overreg-kid-table)) reported is relatively low overall, both for nouns and verbs, ranging from `r roundp(100 * min(by_kid_summary$mean), 0)`% to `r roundp(100 * max(by_kid_summary$mean), 0)`%. For children who overregularize at least one item, the overall overregularization proportion is of course higher, ranging from `r roundp(100 * min(non_zero_summary$mean), 0)`% to `r roundp(100 * max(non_zero_summary$mean), 0)`%, but even these rates are low -- suggesting that those children who overregularize are not overregularizing all or even most forms at the same time. 

```{r overreg-kid-table, dependson="overreg-load"}
bind_rows(by_kid_summary, non_zero_summary) %>%
  pivot_wider(names_from = c(group, lexical_category), values_from = c(mean, n)) %>%
  rename(n = n_all_nouns) %>%
  select(-starts_with("n_")) %>%
  select(language, n, contains("all"), contains("non_zero")) %>%
  kable(digits = 2, col.names = c("Language", "N", "Nouns", "Verbs", "Nouns", "Verbs"),
        caption = "Proportion of noun and verb overregularization across languages.") %>%
  add_header_above(c(" " = 2, "All children" = 2, "Children who overregularize at least one item" = 2))
```

Individual items vary in how often they are overregularized (Table \@ref(tab:overreg-item-table)): in English, items range from `r by_item_summary %>% filter(language == "English (American)", direction == "min") %>% pull(definition) %>% sprintf(fmt = "_%s_") %>% paste(collapse = " and ")`, which are virtually never overregularized, to `r by_item_summary %>% filter(language == "English (American)", direction == "max") %>% pull(definition) %>% sprintf(fmt = "_%s_") %>% paste(collapse = " and ")`, which are overregularized by `r by_item_summary %>% filter(language == "English (American)", direction == "max") %>% pull(prop) %>% map_dbl(partial(prod, 100)) %>% roundp(0) %>% paste0("%") %>% paste(collapse = " and ")` of children, respectively.

```{r overreg-item-table, dependson="overreg-load"}
by_item_summary %>%
  pivot_wider(names_from = c(direction, lexical_category), values_from = c(definition, prop)) %>%
  select(language, contains("min_nouns"), contains("min_verbs"), contains("max_nouns"), contains("max_verbs")) %>%
  kable(digits = 2, col.names = c("Language", "Item", "Proportion", "Item", "Proportion", "Item", "Proportion", "Item", "Proportion"),
        caption = "Most and least overregularized items in each language.") %>%
  add_header_above(c(" " = 1, "Nouns" = 2, "Verbs" = 2, "Nouns" = 2, "Verbs" = 2)) %>%
  add_header_above(c(" " = 1, "Least overregularized" = 4, "Most overregularized" = 4))
```

Figure \@ref(fig:overreg-fits-age) shows each child's proportion of overregularized items plotted by age (for children who overregularize at least one item overall). The major generalization from these data is that curves tend to be surprisingly flat -- there are not large, consistent developmental increases for any language. The inset _r_^2^ for each panel in this graph show the variance explained by quadratic models of overregularization by age, quantitatively confirming the visual impression of limited developmental change -- the largest of these _r_^2^ values is only `r max(age_models$rsq) %>% roundp()`.

```{r overreg-fits-age, fig.width=8, fig.height=3.5, fig.cap="Each child's proportion of items overregularized as a function of their age size in each language (curves show model fits -- overregularization proportion from quadratic and linear terms for age).", dependson="overreg-fits"}
ggplot(overreg_by_kid_nonzero, aes(x = age, y = prop)) +
  facet_grid(lexical_category ~ language, labeller = label_caps) +
  coord_fixed(ratio = 21) +
  geom_jitter(alpha = 0.2, size = 0.75, shape = 1) +
  geom_line(aes(y = .fitted), size = 1.2, colour = .pal()(1),
            data = age_fits) +
  geom_text(aes(label = rsq_print), x = 15.1, y = 0.95, size = 3, hjust = 0,
            family = .font, #parse = TRUE,
            data = age_models) +
  scale_x_continuous(limits = c(16, 36),
                     breaks = seq(16, 36, by = 4),
                     name = "Age (months)") +
  scale_y_continuous(limits = c(0, 1), expand = c(0.01, 0),
                     breaks = c(0, 0.5, 1), labels = c(0, 0.5, 1),
                     name = "Proportion of items overregularized")
```

Overregularization is more tightly correlated with vocabulary size than with age (Figure \@ref(fig:overreg-fits-vocab)), with _r_^2^ values ranging from `r min(vocab_models$rsq) %>% roundp()` to `r max(vocab_models$rsq) %>% roundp()`. However, the relationship between overregularization and vocabulary tends to be far weaker than the relationship between correct morphological inflection and vocabulary (as described in Chapter \@ref(grammar)), for which _r_^2^ is around 0.9.

<!-- Interestingly, the same finding holds true for vocabulary. Overregularization does not appear to be tightly predicted by overall vocabulary size. Figure \@ref(fig:overreg-fits-vocab) shows findings from this analysis. While some slopes might be slightly higher (especially for verbs), overall the total developmental change predicted by vocabulary size seems limited. Contrast these relationships to those described in Chapter \@ref(grammar), where the correlations between vocabulary size and correct morphological inflection are quite high. What predicts reports of overregularization then? -->

```{r overreg-fits-vocab, fig.width=8, fig.height=3.5, fig.cap="Each child's proportion of overregularization as a function of their vocabulary size in each language (curves show model fits -- overregularization proportion from quadratic and linear terms for vocabulary size).", dependson="overreg-fits"}
ggplot(overreg_by_kid_nonzero, aes(x = production_prop, y = prop)) +
  facet_grid(lexical_category ~ language, labeller = label_caps) +
  coord_fixed() +
  geom_jitter(alpha = 0.2, size = 0.75, shape = 1) +
  geom_line(aes(y = .fitted), size = 1.2, colour = .pal()(1),
            data = vocab_fits) +
  geom_text(aes(label = rsq_print), x = 0.05, y = 0.95, size = 3, hjust = 0,
            family = .font, #parse = TRUE,
            data = vocab_models) +
  scale_x_continuous(limits = c(0, 1), expand = c(0.01, 0),
                     breaks = c(0, 0.5, 1), labels = c(0, 0.5, 1),
                     name = "Productive vocabulary size (proportion of items)") +
  scale_y_continuous(limits = c(0, 1), expand = c(0.01, 0),
                     breaks = c(0, 0.5, 1), labels = c(0, 0.5, 1),
                     name = glue("Proportion of items overregularized"))
```

```{r overreg-lexcat-comp}
overreg_lexcat_comp <- overreg_by_kid_cross %>%
  select(language, lexical_category, data_id, prop, age) %>%
  group_by(data_id) %>%
  # filter(!all(prop == 0)) %>%
  spread(lexical_category, prop)

lexcat_neither <- overreg_lexcat_comp %>%
  ungroup() %>%
  mutate(neither = nouns == 0 & verbs == 0) %>%
  count(language, neither) %>%
  mutate(p = n / sum(n)) %>%
  filter(neither)

lexcat_cors <- overreg_lexcat_comp %>%
  group_by(language) %>%
  summarise(rsq = cor(nouns, verbs) ^ 2,
            rsq_print = glue("r² = {roundp(rsq)}"))
```

Another perspective on the structure of these data comes from comparing overregularization across lexical categories, as shown in Figure \@ref(fig:overreg-lexcat-plot). While a substantial proportion of children (`r roundp(min(lexcat_neither$p))`--`r roundp(max(lexcat_neither$p))`) do not overregularize any items, those who do are doing so across nouns and verbs quite consistently, for all of the languages in our sample. *r*^2^ values for the relationship between noun and verb overregularizations range from `r roundp(min(lexcat_cors$rsq))` to `r roundp(max(lexcat_cors$rsq))`.
<!-- One positive finding from our exploration is shown in Figure \@ref(fig:overreg-lexcat-comp). The majority of children do not overregularize, but those who do are doing so across nouns and verbs quite consistently, across all of the languages in our sample. *r*² values for the relationship between noun and verb overregularizations range from `r roundp(min(lexcat_cors$rsq))` to `r roundp(max(lexcat_cors$rsq))`, considerably higher than the relationships documented above. Thus, at a minimum we see within-individual stability in this measure. But we do not yet have a good way of predicting when particular children will show non-zero overregularization. -->

```{r overreg-lexcat-plot, dependson="overreg-lexcat-comp", fig.width=8, fig.height=2.25, fig.cap="Each child's proportion of verbs overregularized against proportion of nouns overregularized (lines show linear model fits -- verb proportion from noun proportion)."}
ggplot(overreg_lexcat_comp, aes(x = nouns, y = verbs)) +
  facet_wrap(~language, nrow = 1) + #, scales = "free") +
  coord_fixed() +
  geom_jitter(position = position_jitter(width = 0.02, height = 0.02),
              colour = .grey, size = 0.9) +
  geom_smooth(method = "lm", se = FALSE, colour = .pal()(1)) +
  geom_text(aes(label = rsq_print), x = 0.05, y = 0.95, size = 3, hjust = 0,
            family = .font, data = lexcat_cors) + #parse = TRUE,
  scale_x_continuous(limits = c(0, 1), expand = c(0.01, 0),
                     breaks = c(0, 0.5, 1), labels = c(0, 0.5, 1),
                     name = "Proportion of nouns overregularized") +
  scale_y_continuous(limits = c(0, 1), expand = c(0.01, 0),
                     breaks = c(0, 0.5, 1), labels = c(0, 0.5, 1),
                     name = "Proportion of verbs\n overregularized")
```

In summary, our data suggests that when aggregated across children, overregularization does not appear to have a set relationship with age, and does relate to vocabulary size, though not nearly as strongly as does correct morphological inflection. Additionally, overregularization is highly variable across children, but relatively stable within children but across lexical categories.


## Longitudinal Data

Next, we ask whether individual children's overregularization trajectories can paint a clearer picture of the overall developmental time course of overregularization. As in other chapters, we make use of the longitudinal data from the American English and Norwegian datasets. These data allow us to examine changes in generalization across individuals. Since data are sparser in the English data than the Norwegian, we pursue slightly different approaches in our analysis.

### English

```{r overreg-eng-longs}
overreg_longs <- overreg_by_kid %>%
  left_join(admins %>% select(data_id, source_name)) %>%
  group_by(language, lexical_category, source_name, original_id) %>%
  mutate(num_admins = n()) %>%
  filter(num_admins > 1)

eng_longs <- overreg_longs %>%
  ungroup() %>%
  filter(language == "English (American)") %>%
  group_by(lexical_category, original_id) %>%
  # group_by(original_id) %>%
  filter(!all(prop == 0)) %>%
  group_by(lexical_category, original_id) %>%
  mutate(num_ages = n_distinct(age))

# eng_ns <- eng_longs %>%
#  ungroup() %>%
#  distinct(lexical_category, original_id, num_ages) %>%
#  count(lexical_category, num_ages) %>%
#  group_by(lexical_category) %>%
#  arrange(lexical_category, desc(num_ages)) %>%
#  mutate(p = n / sum(n),
#     cum_p = cumsum(p))
eng_ns <- eng_longs %>%
  ungroup() %>%
  distinct(original_id, num_ages) %>%
  count(num_ages) %>%
  arrange(desc(num_ages)) %>%
  mutate(p = n / sum(n),
         cum_p = cumsum(p))

eng_min <- 3
eng_long_cats <- eng_longs %>%
  filter(num_ages >= eng_min) %>%
  mutate(age_code = case_when(age == min(age) ~ "youngest",
                              age == max(age) ~ "oldest",
                              TRUE ~ "middle")) %>%
  group_by(lexical_category, original_id, age_code) %>%
  summarise(age = mean(age), prop = mean(prop), n = n()) %>%
  select(-age, -n) %>%
  spread(age_code, prop) %>%
  mutate(step_1 = case_when(middle > youngest ~ "increases",
                            middle == youngest ~ "stays",
                            TRUE ~ "decreases"),
         step_2 = case_when(oldest > middle ~ "increases",
                            oldest == middle ~ "stays",
                            TRUE ~ "decreases"),
         trajectory = case_when(
           step_1 == "stays" & step_2 == "stays" ~ "–",
           step_1 %in% c("stays", "increases") & step_2 %in% c("stays", "increases") ~ "/",
           step_1 %in% c("stays", "decreases") & step_2 %in% c("stays", "decreases") ~ "\\",
           step_1 == "increases" & step_2 == "decreases" ~ "/\\",
           step_1 == "decreases" & step_2 == "increases" ~ "\\/",
           TRUE ~ "other"
         )) %>%
  ungroup() %>%
  mutate(trajectory = fct_infreq(trajectory))

eng_long_cat_props <- eng_long_cats %>%
  count(lexical_category, trajectory) %>%
  group_by(lexical_category) %>%
  mutate(p = n / sum(n),
         label = sprintf("N = %s (%.0f%%)", n, p * 100))

eng_long_grouped <- eng_longs %>%
  right_join(eng_long_cats %>% select(lexical_category, original_id, trajectory)) %>%
  select(lexical_category, original_id, age, prop, trajectory)

eng_long_comp <- eng_long_grouped %>%
  # filter(trajectory %in% c("/", "Λ")) %>%
  pivot_wider(names_from = lexical_category, values_from = c(prop, trajectory)) %>%
  filter(!is.na(prop_nouns), !is.na(prop_verbs)) %>%
  group_by(trajectory_nouns) %>%
  count(trajectory_verbs) %>%
  mutate(p = n / sum(n))
```

In the American English dataset, out of children who overregularize at least one item, there are `r eng_ns %>% filter(num_ages == 3) %>% pull(n)` with three longitudinal administrations, `r eng_ns %>% filter(num_ages == 4) %>% pull(n)` with four administrations, and none with more than that. For each child, we compare their three overregularization values -- youngest, middle, and oldest (with the two middle values averages for the four administration children) -- to categorize their overregularization trajectory as:

- __increase__ (/) if youngest to middle _stays the same_ or _increases_ and middle to oldest _stays the same_ or _increases_
- __decrease__ (\\\) if youngest to middle _stays the same_ or _decreases_ and middle to oldest _stays the same_ or _decreases_
- __recovery__ (Λ) if youngest to middle _increases_ and middle to oldest _decreases_
- __retreat__ (V) if youngest to middle _decreases_ and middle to oldest _increases_

Figure \@ref(fig:overreg-eng-longs-plot) shows the trajectories of each child, grouped by this classification. For both nouns and verbs, the vast majority of children (`r eng_long_cat_props %>% filter(trajectory == "/") %>% pull(p) %>% map_dbl(partial(prod, 100)) %>% roundp(0) %>% paste0("%") %>% paste(collapse = " and ")`, respectively) __increase__ in overregularization over this age range, a substantial minority (`r eng_long_cat_props %>% filter(trajectory == "/\\") %>% pull(p) %>% map_dbl(partial(prod, 100)) %>% roundp(0) %>% paste0("%") %>% paste(collapse = " and ")`) __recover__ from overregularization, and very few __decrease__ or __retreat__. So we see that by 30 months, most children who have shown any sign of overregularization to date are continuing to overregularize more and more, while some are recovering from an earlier peak rate.

<!-- Additionally, trajectory shape is correlated between nouns and verbs: out of the children who have __increase__ noun trajectories, XX also have __increase__ verb trajectories -->

```{r overreg-eng-longs-plot, fig.width=8, fig.height=4.25, fig.cap="Empirical overregularization trajectories for American English children with at least three observations, categorized by overall shape."}
ggplot(eng_long_grouped, aes(x = age, y = prop)) +
  facet_grid(lexical_category ~ trajectory, labeller = label_caps, switch = "y") +
  geom_line(aes(colour = original_id), alpha = .30) +
  geom_text(aes(label = label), family = .font, hjust = 0, vjust = 1, size = 3,
            x = min(eng_long_grouped$age), y = max(eng_long_grouped$prop),
            data = eng_long_cat_props) +
  .scale_colour_numerous(guide = FALSE) +
  labs(x = "Age (months)", y = glue("Proportion of items overregularized")) +
  scale_x_continuous(breaks = seq(18, 30, 3)) +
  theme(strip.placement = "outside")
```


### Norwegian

```{r overreg-nor-longs}
nor_min <- 4
nor_longs <- overreg_longs %>%
  ungroup() %>%
  filter(language == "Norwegian") %>%
  group_by(original_id, lexical_category) %>%
  filter(!all(prop == 0)) %>%
  group_by(lexical_category, original_id) %>%
  mutate(num_ages = n_distinct(age)) %>%
  ungroup() %>%
  filter(num_ages >= nor_min)
```

```{r overreg-nor_models, eval=FALSE}
nor_models <- nor_longs %>%
  # filter(num_ages >= model_min) %>%
  select(original_id, data_id, lexical_category, age, num_true, num_false, prop, total) %>%
  nest(data = c(-lexical_category, -original_id)) %>%
  mutate(
    null = map(data, function(df) {
      glm(prop ~ 1, weights = total, family = "binomial", data = df)
    }),
    linear = map(data, function(df) {
      glm(prop ~ age, weights = total, family = "binomial", data = df)
    }),
    quadratic = map(data, function(df) {
      glm(prop ~ age + I(age^2), weights = total, family = "binomial", data = df)
    })
  )

nor_models <- nor_models %>%
  ungroup() %>%
  select(-data) %>%
  gather(model_type, model, -original_id, -lexical_category)

nor_aic <- nor_models %>%
  mutate(aic = map_dbl(model, AIC)) %>%
  select(-model) %>%
  filter(model_type != "null")

nor_rsq <- nor_models %>%
  mutate(loglik = map_dbl(model, logLik),
         n = map_dbl(model, ~length(.$fitted.values))) %>%
  select(-model) %>%
  spread(model_type, loglik) %>%
  gather(model_type, loglik, linear, quadratic) %>%
  rename(loglik_null = null) %>%
  mutate(rsq = 1 - (loglik / loglik_null)) %>%
  select(-loglik_null, -loglik) 

nor_model_comp <- left_join(nor_aic, nor_rsq) %>%
  pivot_wider(names_from = model_type, values_from = c(aic, n, rsq)) %>%
  mutate(winner = if_else(aic_quadratic < aic_linear, "quadratic", "linear")) %>%
  pivot_longer(cols = c(contains("linear"), contains("quadratic")),
               names_to = c("measure", "model_type"), names_sep = "_",
               values_to = "value") %>%
  pivot_wider(names_from = measure, values_from = value)
feather::write_feather(nor_model_comp, "data/overregularization/nor_model_comp.feather")

nor_coefs <- nor_models %>%
  ungroup() %>%
  filter(model_type != "null") %>%
  mutate(coefs = map(model, broom::tidy)) %>%
  select(-model) %>%
  unnest(cols = coefs)
feather::write_feather(nor_coefs, "data/overregularization/nor_coefs.feather")

ages <- tibble(age = min(nor_longs$age):max(nor_longs$age))
nor_fits <- nor_models %>%
  ungroup() %>%
  filter(model_type != "null") %>%
  mutate(fits = map(model, function(m){
    ages %>% mutate(.fitted = predict(m, newdata = ages, type = "response"))
  }))

nor_fit_vals <- nor_fits %>%
  select(-model) %>%
  unnest(cols = fits)
feather::write_feather(nor_fit_vals, "data/overregularization/nor_fit_vals.feather")
```

```{r overreg-nor-traj}
nor_model_comp <- feather::read_feather("data/overregularization/nor_model_comp.feather")
nor_coefs <- feather::read_feather("data/overregularization/nor_coefs.feather")
nor_fit_vals <- feather::read_feather("data/overregularization/nor_fit_vals.feather")

nor_groups <- nor_coefs %>%
  filter(term != "(Intercept)") %>%
  left_join(nor_model_comp) %>%
  filter(model_type == winner, n >= 4) %>%
  mutate(positive = if_else(estimate > 0, "positive", "negative"),
         term = fct_recode(term, "age2" = "I(age^2)")) %>% #"intercept" = "(Intercept)", 
  select(original_id, lexical_category, num_admins = n, winner, term, positive) %>%
  pivot_wider(names_from = term, values_from = positive, names_prefix = "direction_") %>%
  mutate(trajectory = case_when(
    winner == "linear" & direction_age == "positive" ~ "/",
    winner == "linear" & direction_age == "negative" ~ "\\",
    winner == "quadratic" & direction_age2 == "positive" ~ "\\/",
    winner == "quadratic" & direction_age2 == "negative" ~ "/\\",
    TRUE ~ "ALERT"
  )) %>%
  mutate(trajectory = fct_infreq(trajectory))

nor_group_counts <- nor_groups %>%
  count(lexical_category, trajectory) %>%
  group_by(lexical_category) %>%
  mutate(p = n / sum(n),
         label = sprintf("N = %s (%.0f%%)", n, p * 100))

nor_fit_vals_grouped <- nor_fit_vals %>%
  left_join(nor_groups) %>%
  filter(model_type == winner) %>%
  mutate(id_n = paste(original_id, num_admins)) %>%
  mutate(original_id = fct_reorder(original_id, num_admins))
```

Because longitudinal data are so much more plentiful in the Norwegian dataset, we can quantify children's trajectories more rigorously. For the `r n_distinct(nor_longs$original_id)` number of children who overregularize at least one item and have at least `r nor_min` administrations, we fit a logistic regression for each child predicting how many items they overregularize from their age. For each child, we select either a model with a linear effect of age or both linear and quadratic effects of age based on which one fits the data better (i.e. has the lower AIC). We then classify each child's trajectory as: 

- __increase__ (/) if the best fit model is _linear_ and the effect of age is _positive_
- __decrease__ (\) if the best fit model is _linear_ and the effect of age is _negative_
- __recovery__ (Λ) if the best fit model is _quadratic_ and the quadratic effect of age is _negative_
- __retreat__ (V) if the best fit model is _quadratic_ and the quadratic effect of age is _positive_

These classifications are analogous to the three datapoint ones from the English data, but are taking advantage of the higher density in Norwegian to have smoothed trajectories and model-based estimates. Figure \@ref(fig:overreg-nor-groups-plot) shows the grouped trajectories of each child. In this dataset, which extend to 36 months, many more children exhibit recovery trajectories for both nouns and verbs (`r nor_group_counts %>% filter(trajectory == "/\\") %>% pull(p) %>% map_dbl(partial(prod, 100)) %>% roundp(0) %>% paste0("%") %>% paste(collapse = " and ")`) and fewer exhibit increase trajectories (`r nor_group_counts %>% filter(trajectory == "/") %>% pull(p) %>% map_dbl(partial(prod, 100)) %>% roundp(0) %>% paste0("%") %>% paste(collapse = " and ")`), for an approximately even split between the two types. While the English and Norwegian data may differ in a variety of ways, it's plausible that the difference reflects that many children are recovering from overregularizing between 30 and 36 months (an age range that is not represented in the English dataset).

<!-- Because longitudinal data are so much more plentiful in the Norwegian dataset, we are able to map proportions within individual children. Figure \@ref(overreg-nor-longs-age) shows smoothed curves for those children with at least 4 administrations. As in the cross-sectional data, we see noun and verb overregularization traveling together developmentally. Further, we see that the moment that over-regularization is reported seems to vary substantially by child. Some children are continuing to increase their overregularization throughout the sampling period, while others go through a discrete phase (at least for the high-frequency items shown on the form) and then return to zero by the end of the sampling period at age 3. Others barely over-regularize in this period. Thus, at a minimum we can conclude there is truly substantial individual variation in overregularization. -->

```{r overreg-nor-groups-plot, dependson="overreg-nor-traj", fig.width=8, fig.height=4.25, fig.cap=glue("Model fit overregularization trajectories for Norweigian children with at least {nor_min} observations, categorized by overall shape.")}
ggplot(nor_fit_vals_grouped, aes(x = age, y = .fitted)) +
  facet_grid(lexical_category ~ trajectory, labeller = label_caps, switch = "y") +
  geom_line(aes(group = id_n, colour = original_id, alpha = num_admins)) +
  geom_text(aes(label = label), family = .font, hjust = 0, vjust = 1, size = 3,
            x = min(nor_fit_vals_grouped$age), y = max(nor_fit_vals_grouped$.fitted),
            data = nor_group_counts) +
  .scale_colour_numerous(guide = FALSE) +
  scale_alpha_continuous(guide = FALSE) +
  scale_x_continuous(breaks = seq(16, 36, 4)) +
  labs(x = "Age (months)", y = "Model fit probability of overregularizing") +
  theme(strip.placement = "outside")
```

```{r overreg-nor-lexcat, dependson="overreg-nor-traj"}
nor_lexcat <- nor_groups %>%
  select(original_id, lexical_category, trajectory) %>%
  pivot_wider(names_from = lexical_category, values_from = trajectory) %>%
  filter(!is.na(nouns), !is.na(verbs))

nor_lexcat_props <- nor_lexcat %>%
  group_by(nouns) %>%
  count(verbs) %>%
  mutate(p = n / sum(n))

nor_lexcat_labels <- nor_lexcat_props %>%
  group_by(nouns) %>%
  mutate(sp = cumsum(p) - 0.5 * p) %>%
  filter(nouns == verbs)
```

Additionally, we see evidence that trajectory shape is correlated between nouns and verbs: out of the children who have __recovery__ noun trajectories, `r nor_lexcat_labels %>% filter(verbs == "/\\") %>% pull(p) %>% prod(100) %>% roundp(0)`% also have __recovery__ verb trajectories; conversely, out of the children who have __increase__ noun trajectories, `r nor_lexcat_labels %>% filter(verbs == "/") %>% pull(p) %>% prod(100) %>% roundp(0)`% also have __increase__ verb trajectories (see Figure \@ref(fig:overreg-nor-lexcat-plot)). This echoes the observation from the cross-sectional data that while substantial variation between children, there is some degree of consistency within child across lexical categories.

```{r overreg-nor-lexcat-plot, dependson="overreg-nor-lexcat", out.width="75%", fig.cap="Proportion of children exhbiting each verb overrregularization trajectory type as a function of noun overregularization trajectory type."}
ggplot(nor_lexcat_props, aes(x = nouns, y = p, fill = fct_rev(verbs))) +
  geom_col() +
  geom_text(aes(label = verbs, y = sp), data = nor_lexcat_labels, fontface = "bold") +
  .scale_fill_discrete() +
  labs(x = "Noun trajectory",
       fill = "Verb trajectory",
       y = "Proportion of children")
```

```{r overreg-nor-dense, dependson="overreg-nor-traj"}
min_admin_plot <- 9
nor_fit_demo <- nor_fit_vals_grouped %>%
  filter(trajectory == "/\\", num_admins >= min_admin_plot) %>%
  group_by(original_id) %>%
  filter(all(c("nouns", "verbs") %in% lexical_category)) %>%
  mutate(sum_fitted = sum(.fitted)) %>%
  ungroup() %>%
  mutate(original_id = fct_reorder(original_id, sum_fitted, .desc = TRUE),
         lexical_category = as.character(label_caps(lexical_category)))

nor_max_demo <- nor_fit_demo %>%
  group_by(original_id, lexical_category) %>%
  filter(.fitted == max(.fitted))

# nor_longs_demo <- nor_longs %>%
#  ungroup() %>%
#  inner_join(nor_fit_demo) %>%
#  mutate(original_id = fct_reorder(original_id, sum_fitted, .desc = TRUE))
#     # lexical_category = as.character(label_caps(lexical_category)))
# 
# nor_fit_vals_grouped %>%
#  filter(trajectory == "Λ") %>%
#  group_by(original_id, lexical_category) %>%
#  filter(.fitted == max(.fitted)) %>%
nor_max_summary <- nor_max_demo %>%
  group_by(lexical_category) %>%
  summarise(mean_max = mean(age),
            median_max = median(age),
            min_max = min(age),
            max_max = max(age))
```

Lastly, for a more detailed look at recovery from the overregularization, we examine the trajectories of the `r n_distinct(nor_fit_demo$original_id)` Norwegian children with the most observations (at least `r min_admin_plot`) who have recovery-type trajectories for both nouns and verbs (Figure \@ref(fig:overreg-nor-dense-plot)). We observe that for many of these children, the trajectories for nouns and verbs do not just have the same overall type, but also hang together over the course of development. The median age when these children are most likely to overregularize is `r nor_max_summary %>% filter(lexical_category == "Nouns") %>% pull(median_max)` months for nouns and `r nor_max_summary %>% filter(lexical_category == "Verbs") %>% pull(median_max)` months for verbs, consistent with the speculation above that 30 months marks the beginning of more widespread recovery.

```{r overreg-nor-dense-plot, dependson="overreg-nor-dense", fig.width=8, fig.height=7, fig.cap=glue("Model fit overregularization trajectories for Norwegian children with recovery-type trajectories and at least {min_admin_plot} observations. Marks in each line show the inflection point of the recovery.")}
s <- 0.03
ggplot(nor_fit_demo, aes(x = age, y = .fitted, colour = lexical_category)) +
  facet_wrap(~original_id, ncol = 6) +
  # geom_point(aes(y = prop), alpha = 0.5, size = 0.8, data = nor_longs_demo) +
  geom_line(size = 0.7) +
  geom_segment(aes(xend = age, y = .fitted - s, yend = .fitted + s), size = 1, data = nor_max_demo) +
  # geom_point(data = nor_max_demo) +
  .scale_colour_discrete(name = "") +
  scale_linetype(guide = FALSE) +
  scale_x_continuous(breaks = seq(16, 36, 4)) +
  labs(x = "Age (months)", y = "Model fit probability of overregularizing") +
  theme(legend.position = "top",
        strip.text = element_blank())
```

## Conclusions

This chapter examined overregularization data from the noun and verb morphology items of the Words and Sentences form in English and Norwegian. A central takeaway from our analyses is that there is tremendous heterogeneity in these data -- some children are never reported to overgeneralize within the age range of the sample, while others do substantially more, without a set developmental timecourse across children. Children with larger vocabularies tend to overregularize more. Overregularization also tends to proceed in tandem for nouns and verbs, in both cross-sectional and longitudinal data. Furthermore, individual children's trajectories can be fruitfully categorized by overall shape, leading to the observation that for children who overregularize, approximately half begin recovery towards correct inflection at around 30 months and half continue to overregularize more and more through 36 months. 

One important caveat to these findings is the possibility that parents are less keen observers of morphological generalization than they are of vocabulary growth more broadly. It is possible that the lack of systematicity we observed is due to inconsistency in which parents report overgeneralization -- perhaps only some parents are sensitized to the somewhat meta-linguistic observation that their child is using a frequent ending incorrectly (e.g., *foots*). This kind of bias would be consistent with the noun-verb overregularization correlation we observed -- only systematic validation outside of the CDI would truly dispel this worry. 

On the other hand, the kind of variability we observed is not unlike the variability observed in naturalistic studies of overgeneralization [e.g., @marcus1992]. Thus our work here suggests caution in the received narrative of morphological generalization as just another stage in the predictable progression of language learning. Unlike, say, word combination (cf. Chapter \@ref(grammar)), we do not see as clear and consistent developmental progression in this more elusive behavior.
