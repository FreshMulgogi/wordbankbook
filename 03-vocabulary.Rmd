# Vocabulary Development {#vocab}

## Abstract

This chapter focuses on a particular view of the data, namely that each child is represented by a single vocabulary score: the proportion of words that child knows out of the total in the form. We begin by examining quantify the nature of variability across individuals and languages. We also note differences in form ceilings across languages. Then, the bulk of this chapter is devoted to different demographic predictors of vocabulary growth across languages (following the EFAI approach). We compare the effects of gender (female advantage), birth order (first-born advantage), and maternal education (socioeconomic status – SES – advantage). 

## Variability in vocabulary development

```{r 3_vocab_admins}
num_words <- items %>%
  filter(type == "word") %>%
  group_by(language, form) %>%
  summarise(n = n())

vocab_data <- admins %>%
  select(data_id, language, form, age, sex, 
         mom_ed, birth_order, production, comprehension) %>% 
  left_join(num_words) %>%
  mutate(no_production = n - production)

min_age <- min(vocab_data$age)
max_age <- max(vocab_data$age)
```

```{r 3_models}
taus <-  c(0.1, 0.25, 0.5, 0.75, 0.9)
ages <- 8:18

fit_gcrq <- function(x) {
  mod <- try(gcrq(formula = mean ~ ps(age, monotone = 1, 
                                      lambda = 1000), 
                  tau = taus, data = x))
  
  if(inherits(mod, "try-error"))
  {
    return(NA)
  }
  
  return(mod)
}

pred_gcrq <- function(x, mods) {
  mod <- mods[[x$language[1]]]
  
  if (is.na(mod[1])) {
    return(expand.grid(age = x$age, 
                       language = x$language[1], 
                       percentile = as.character(taus*100), 
                       pred = NA))
  } else {
    preds <- predictQR_fixed(mod, 
                             newdata = x) %>%
      data.frame %>%
      mutate(age = x$age, 
             language = x$language) %>%
      gather(percentile, pred, starts_with("X")) %>%
      mutate(percentile = as.character(as.numeric(str_replace(percentile, 
                                                              "X", "")) 
                                       * 100))
    return(preds)
  }
}
```

One of the most important features of early vocabulary development is its variability [@fenson1994]. Consider the English production data from the Words and Sentences form.

```{r 3_eng_prod}
eng_prod_data <- vocab_data %>%
  filter(form == "WS", language == "English") %>%
  mutate(mean = production)

eng_prod_model <- list()
eng_prod_model$English <- eng_prod_data %>%
  fit_gcrq

eng_prod_preds <- eng_prod_data %>%
  group_by(age, language) %>%
  summarise(n = n()) %>%
  data.frame() %>% 
  pred_gcrq(eng_prod_model)

ggplot(eng_prod_data,
       aes(x = age, y = mean)) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = eng_prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(16, 30, 4),
                     limits = c(16, 30),
                     name = "Age (months)") +
  ylab("Production (Number of Words)") +
  ylim(c(0, 680)) + 
  theme(legend.position = "bottom")
```

It's immediately clear that there is tremendous variability in vocabulary. Consider just a single age group, two-year-olds (24 months). The distribution of vocabularies across children is far from normally-distributed, with many children at the very bottom of the scale and almost as many at the top. Quite a few two-year-olds on their second birthday are producing only a handful of words (or at least their parents say they are) and others are producing more than 600 listed on the form, with the total number higher than that even.^[It will quickly get tiresome to acknowledge ceiling effects and parent report biases in every sentence, so we will acknowledge them up front and then mention them only when relevant throughout.] 

```{r}
ggplot(filter(eng_prod_data, age == 24), 
       aes(x = production)) + 
  geom_histogram(aes(y = ..density..), binwidth=30) + 
  geom_density(col = "red", aes(y = ..density..)) +
  xlim(0,680) + 
  xlab("Number of words produced")
       
```

One way to describe these data is to consider the relationship of the variance to the central tendency. For example, in this age group, the mean productive vocabulary is `r round(mean(eng_prod_data$production[eng_prod_data$age == 24]))` words, and the standard deviation is `r round(sd(eng_prod_data$production[eng_prod_data$age == 24]))` words. But this distribution is far from normal (especially at the younger and older ages), so a non-parametric approach is warranted. We can  compute the median absolute deviation from the median (MAD), which captures how far away values are from the median (a measure of variance, similar to the inter-quantile range or IQR) and divide by the median itself, giving us an intuitive sense of how the spread of the data relates to the central tendency. We'll call this number the MMAD.

```{r 3_madm1}
mmad <- function(x) {median(x) / mad(x) }
madm <- function(x) {mad(x) / median(x) }

m_sd <- vocab_data %>%
  filter(language == "English") %>%
  group_by(form, age) %>%
  summarise(median = median(production), 
            mad = mad(production), 
            ratio = median / mad)

ggplot(m_sd, aes(x = age, y = ratio, col = form)) + 
  geom_line() + 
  ylim(0,2) + 
  xlim(8,30) + 
  ylab("MADM (median / MAD)") + 
  xlab("Age (months)")
```

In English production, this ratio is actually close to 1 from age one until almost age two, suggesting that the standard *difference* from the median is actually as big as the median itself! The decline begins before variability is substantially truncated by the ceiling of the form, suggesting that variability between kids is really highest before the second birthday. The same pattern is generally found across the languages in our database, with very high variance between the first and second birthdays. What does this MADM measure mean, exactly? It's a non-parametric version of Cohen's $d$. In fact, they are very highly correlated. 

```{r 3_madm_normal}
madm_ratio <- vocab_data %>%
  group_by(language, form, age) %>%
  filter(n() > 20) %>%
  summarise(median = median(production), 
            mad = mad(production), 
            ratio = median / mad, 
            cov_madm = mad / median,
            normal_ratio = mean(production) / sd(production) )

qplot(ratio, normal_ratio, 
      data = madm_ratio, geom = c("point","smooth")) + 
  ylim(0,3) + xlim(0,3) + 
  geom_abline(lty = 2) + 
  ylab("Cohen's d") + 
  xlab("MADM")
```

Imagine groups of three children. A group where one produced 30 words, one produced 100, and another produced 170 would have a MADM of `r round(madm(c(33,100,180)), digits = 2)`. In contrast, one where they were more closely grouped -- say 70, 100, 130 -- would have a MADM of `r round(madm(c(70,100,130)), digits = 2)`.

```{r 3_madm2}

ggplot(madm_ratio, aes(x = age, y = ratio, col = language)) + 
  geom_jitter(size = 1, alpha = 1) + 
  geom_smooth(aes(group  = 1)) + 
  ylim(0,2) + 
  ylab("median / MAD") + 
  xlab("Age (months)") + 
  scale_color_discrete(guide = FALSE)
```

```{r 3_madm3}

ggplot(madm_ratio, aes(x = age, y = cov_madm, col = language)) + 
  geom_jitter(size = 1, alpha = 1) + 
  geom_smooth(aes(group  = 1)) + 
  ylim(0,1.6) + 
  ylab("MAD / median") + 
  xlab("Age (months)") + 
  scale_color_discrete(guide = FALSE)
```

The next figure shows MADM across languages and instruments. This similarity in variability structure is quite striking, such that between the first and second birthdays, language is remarkably variable. Below, we will use this variability as a way to measure the size of demographic effects. For example, how much variability is due to gender, compared with simple population variability?



## Norms

This set of analyses examines general patterns of vocabulary development. 


Here we examine general patterns of variability across languages. 

### Comprehension


```{r 3_comprehension}
comp_data <- vocab_data %>%
  filter(form == "WG") %>%
  mutate(mean = comprehension / n)

comp_models <- comp_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

comp_preds <- comp_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, comp_models)) 

ggplot(comp_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = comp_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(8, 18, 4),
                     limits = c(8, 18),
                     name = "Age (months)") +
  ylab("Comprehension Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```

### Production

Words and Gestures.

```{r 3_production_wg}
prod_data <- vocab_data %>%
  filter(form == "WG") %>%
  mutate(mean = production / n)

prod_models <- prod_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

prod_preds <- prod_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, prod_models)) 

ggplot(prod_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(8, 36, 4),
                     limits = c(8, 36),
                     name = "Age (months)") +
  ylab("Production Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```

Words and Sentences

```{r 3_production_ws}
prod_data <- vocab_data %>%
  filter(form == "WS") %>%
  mutate(mean = production / n)

prod_models <- prod_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

prod_preds <- prod_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, prod_models)) 

ggplot(prod_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .05) +
  geom_line(data = prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(16, 36, 4),
                     limits = c(16, 36),
                     name = "Age (months)") +
  ylab("Production Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```


### Comparions of Variability on Comprehension and Production


## Demographic Variables

We examine the patterns of vocabulary growth for individual demographic variables. 

To make these analyses work, we assume that all demographics interact with age in a simple way in the models, such that there is only one coefficient associated with the effect:

age * demographic - demographic

All of these analyses are carried out on production data. 


### Gender

This analysis examines how vocabulary development differs by children's reported gender, replicating and extending the results of:

Eriksson, M., Marschik, P. B., Tulviste, T., Almgren, M., Pérez Pereira, M., Wehberg, S., ... Gallego, C. (2012). Differences between girls and boys in emerging language skills: Evidence from 10 language communities. British Journal of Developmental Psychology 30, 326–343.

An earlier version of this analysis was reported in @frank2016.

Plot vocabulary size over age by gender.

```{r 3_gender_plot, fig.width=13, fig.height=8}
sex_data <- vocab_data %>%
  filter(!is.na(sex), form == "WS") 

sex_means <- sex_data %>%
  group_by(language, sex, age) %>%
  summarise(median = median(production/n))

fit_sex <- function(x) {
  robustbase::glmrob(cbind(production, no_production) ~ age * sex - sex,
                     family = "binomial",
                     data = x)
}

pred_sex <- function(x) {
  x$pred <- predict(sex_models[[x$language[1]]], 
                    newdata = x, type = "response")
  return(x)
}

sex_models <- sex_data %>%
  split(.$language) %>%
  map(fit_sex) 

sex_preds <- expand.grid(language = unique(sex_means$language), 
                         age = min_age:max_age, 
                         sex = unique(sex_means$sex)) %>%
  split(.$language) %>%
  map_df(pred_sex)

ggplot(sex_means,
       aes(x = age, y = median, colour = sex, label = sex)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = sex_preds, aes(y = pred)) + 
  scale_colour_solarized(name="Sex") +
  scale_x_continuous(breaks = seq(min(sex_means$age), 
                                  max(sex_means$age), 4),
                     limits = c(min(sex_means$age), max(sex_means$age)),
                     name = "Age (months)") +
  ylab("Median Productive Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```

Get gender in terms of MMAD

```{r 3_gender_madm}
gender_mmad_ratio <- vocab_data %>%
  group_by(language, form, age, sex) %>%
  filter(n() > 20) %>%
  summarise(median_prod = median(production), 
            mad_prod = mad(production), 
            n = n()) %>%
  group_by(language, form, age) %>%
  filter(n() == 2) %>%
  summarise(ratio = (median_prod[sex == "Female"] - median_prod[sex == "Male"]) / mean(mad_prod))

ggplot(gender_mmad_ratio, 
       aes(x = age, y = ratio, col = language)) + 
  geom_jitter() + 
  geom_smooth(aes(group = 1)) + 
  scale_color_discrete(guide = FALSE)
```


### Maternal education

We use maternal education as a proxy for socio-economic status. 

```{r 3_mom_ed}
ses_data <- vocab_data %>%
  filter(!is.na(mom_ed), form == "WS") %>%
  mutate(mom_ed = fct_collapse(mom_ed, 
                               `Below Secondary` = c("None","Primary",
                                                     "Some Secondary"),
                               `Secondary` = c("Secondary", "Some College"),
                               `College and Above` = c("College", 
                                                       "Some Graduate", 
                                                       "Graduate")))

ses_means <- ses_data %>%
  group_by(language, mom_ed, age) %>%
  summarise(median = median(production/n))

fit_ses <- function(x) {
  robustbase::glmrob(cbind(production, no_production) ~ 
                       age * mom_ed  - mom_ed,
                     family = "binomial",
                     data = x)
}

pred_ses <- function(x) {
  x$pred <- predict(ses_models[[x$language[1]]], 
                    newdata = x, type = "response")
  return(x)
}

ses_models <- ses_data %>%
  split(.$language) %>%
  map(fit_ses) 

ses_preds <- expand.grid(language = unique(ses_means$language), 
                         age = min_age:max_age, 
                         mom_ed = unique(ses_means$mom_ed)) %>%
  split(.$language) %>%
  map_df(pred_ses)

ggplot(ses_means,
       aes(x = age, y = median, colour = mom_ed, label = mom_ed)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = ses_preds, aes(y = pred)) + 
  scale_colour_solarized(name="Maternal Education") +
  scale_x_continuous(breaks = seq(min(ses_means$age), 
                                  max(ses_means$age), 4),
                     limits = c(min(ses_means$age), max(ses_means$age)),
                     name = "Age (months)") +
  ylab("Median Productive Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```


### Birth order

Only `r length(unique(filter(vocab_data,!is.na(birth_order))$language))` languages have birth order data, and only `r length(unique(filter(vocab_data,!is.na(birth_order), form == "WS")$language))` languages have it for WS.

```{r 3_birth_order}
ord_data <- vocab_data %>%
  filter(!is.na(birth_order), form == "WS") %>%
  mutate(birth_order = fct_collapse(birth_order, 
                                    "Third+" = c("Third","Fourth",
                                                 "Fifth","Sixth",
                                                 "Seventh","Eighth")))

ord_means <- ord_data %>%
  group_by(language, birth_order, age) %>%
  summarise(median = median(production/n))

fit_ord <- function(x) {
  robustbase::glmrob(cbind(production, no_production) ~ 
                       age * birth_order  - birth_order,
                     family = "binomial",
                     data = x)
}

pred_ord <- function(x) {
  x$pred <- predict(ord_models[[x$language[1]]], 
                    newdata = x, type = "response")
  return(x)
}

ord_models <- ord_data %>%
  split(.$language) %>%
  map(fit_ord) 

ord_preds <- expand.grid(language = unique(ord_means$language), 
                         age = min_age:max_age, 
                         birth_order = unique(ord_means$birth_order)) %>%
  split(.$language) %>%
  map_df(pred_ord)


ggplot(ord_means,
       aes(x = age, y = median, colour = birth_order, 
           label = birth_order)) +
  facet_wrap( ~language) +
  geom_point(alpha=.2) +
  geom_line(data = ord_preds, aes(y = pred)) + 
  scale_colour_solarized(name="Birth Order") +
  scale_x_continuous(breaks = seq(min(ord_means$age), 
                                  max(ord_means$age), 4),
                     limits = c(min(ord_means$age), max(ord_means$age)),
                     name = "Age (months)") +
  ylab("Median Productive Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```

### Demographic effect sizes 


## MMAD method


Demographics in terms of MMAD

```{r 3_ses_mmad}
ses_mmad_ratio <- ses_data %>%
  group_by(language, form, age, mom_ed) %>%
  filter(n() > 10) %>%
  summarise(median_prod = median(production), 
            mad_prod = mad(production), 
            n = n()) %>%
  group_by(language, form, age) %>%
  filter(sum(mom_ed == "Secondary") == 1 & sum(mom_ed == "Below Secondary") == 1) %>%
  summarise(bs_ratio = (median_prod[mom_ed == "Secondary"] - median_prod[mom_ed == "Below Secondary"]) / mean(mad_prod[mom_ed %in% c("Below Secondary","Secondary")]))

ggplot(ses_mmad_ratio, 
       aes(x = age, y = bs_ratio, col = language)) + 
  geom_jitter() + 
  geom_smooth(se=FALSE, span = 1) + 
  scale_color_discrete()+ 
  ylim(c(-1,1))
```


```{r 3_ses_mmad_sps}
ses_mmad_ratio <- ses_data %>%
  group_by(language, form, age, mom_ed) %>%
  filter(n() > 10) %>%
  summarise(median_prod = median(production), 
            mad_prod = mad(production), 
            n = n()) %>%
  group_by(language, form, age) %>%
  filter(sum(mom_ed == "College and Above") == 1 & sum(mom_ed == "Secondary") == 1) %>%
  summarise(ps_ratio = (median_prod[mom_ed == "College and Above"] - median_prod[mom_ed == "Secondary"]) / mean(mad_prod[mom_ed %in% c("College and Above","Secondary")]))

ggplot(ses_mmad_ratio, 
       aes(x = age, y = ps_ratio, col = language)) + 
  geom_jitter() + 
  geom_smooth(se=FALSE, span = 1) + 
  scale_color_discrete()+ 
  ylim(c(-1,1))
```

## ABC method
How can we compare the size of these different demographic effects? One simple way to do so is to integrate the area between curves. 

The units for this analysis are arbitrary and (right now) can't be compared across languages, since the curves have different lengths. To overcome this limitation, we'd need to look at 

```{r 3_effect_size}
momed_levels <- levels(ses_means$mom_ed)

ses_abc <- ses_preds %>%
  spread(mom_ed, pred) %>%
  group_by(language) %>%
  summarise(mom_secondary_ed = sum(`Secondary` - 
                                     `Below Secondary`, na.rm=TRUE), 
            mom_college_ed = sum(`College and Above` - 
                                   `Secondary`, na.rm=TRUE))

sex_abc <- sex_preds %>%
  spread(sex, pred) %>%
  group_by(language) %>%
  summarise(female = sum(Female - Male, na.rm=TRUE))

ord_abc <- ord_preds %>%
  spread(birth_order, pred) %>%
  group_by(language) %>%
  summarise(firstborn = sum(`First` - `Second`, na.rm=TRUE), 
            secondborn = sum(`Second` - `Third+`, na.rm=TRUE))

abcs <- left_join(sex_abc, ord_abc) %>%
  left_join(ses_abc) %>%
  gather(demographic, area_diff, female, firstborn, secondborn, 
         mom_secondary_ed, mom_college_ed) %>%
  mutate(demographic = fct_relevel(demographic, 
                                   c("female", "firstborn", 
                                     "secondborn", "secondary", 
                                     "college")))
```

First look at gender advantage. 

```{r 3_gender_advantage}
ggplot(filter(abcs, demographic == "female"), 
       aes(x = fct_reorder(language, area_diff), y = area_diff)) + 
  geom_point() + 
  coord_flip() + 
  ylab("Advantage for demographic characteristic") + 
  xlab("") + 
  ylim(c(0, 2.5)) + 
  theme(legend.position = "bottom")
```

Visualizing demographic advantages against one another. 

```{r 3_demographic_advantages}
n_missing <- abcs %>%
  group_by(language) %>%
  summarise(n_missing = sum(is.na(area_diff)))

ggplot(left_join(abcs, n_missing) %>% filter(n_missing < 3), 
       aes(x = fct_reorder(language, area_diff), 
           group = demographic, col = demographic, 
           y = area_diff)) + 
  geom_line() + 
  ylab("Advantage for demographic characteristic") + 
  xlab("") + 
  ylim(c(0, 4)) + 
  theme(legend.position = "bottom")
```
