# Vocabulary Development {#vocab}

This chapter focuses on a particular view of the data, namely that each child is represented by a single vocabulary score: the proportion of words that child knows out of the total in the form. We begin by quantifying the nature of variability across individuals, ages, and languages. 


```{r 3_vocab_admins}
num_words <- items %>%
  filter(type == "word") %>%
  group_by(language, form) %>%
  summarise(n = n())

vocab_data <- admins %>%
  select(data_id, language, form, age, sex, 
         mom_ed, birth_order, production, comprehension) %>% 
  left_join(num_words) %>%
  mutate(no_production = n - production)

min_age <- min(vocab_data$age)
max_age <- max(vocab_data$age)
```

```{r 3_models}
taus <-  c(0.1, 0.25, 0.5, 0.75, 0.9)
ages <- 8:18

fit_gcrq <- function(x) {
  mod <- try(gcrq(formula = mean ~ ps(age, monotone = 1, 
                                      lambda = 1000), 
                  tau = taus, data = x))
  
  if(inherits(mod, "try-error"))
  {
    return(NA)
  }
  
  return(mod)
}

pred_gcrq <- function(x, mods) {
  mod <- mods[[x$language[1]]]
  
  if (is.na(mod[1])) {
    return(expand.grid(age = x$age, 
                       language = x$language[1], 
                       percentile = as.character(taus*100), 
                       pred = NA))
  } else {
    preds <- predictQR_fixed(mod, 
                             newdata = x) %>%
      data.frame %>%
      mutate(age = x$age, 
             language = x$language) %>%
      gather(percentile, pred, starts_with("X")) %>%
      mutate(percentile = as.character(as.numeric(str_replace(percentile, 
                                                              "X", "")) 
                                       * 100))
    return(preds)
  }
}
```

## Norms

We begin with the general pattern of data across the instruments. 

### Comprehension

Comprehension is typically meausured only for younger children, using Words and Gestures instruments.^[With the exception of populations like signers, e.g. in the case of British Sign Language, which is truncated here.] 

```{r 3_comprehension}
comp_data <- vocab_data %>%
  filter(form == "WG") %>%
  mutate(mean = comprehension / n)

comp_models <- comp_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

comp_preds <- comp_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, comp_models)) 

# breaks = seq(8, 18, 4),
#                      limits = c(8, 18),
ggplot(comp_data, 
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = comp_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(name = "Age (months)", 
                     seq(8, 18, 4),
                     limits = c(8, 18)) +
  scale_y_continuous(breaks = c(0, .5, 1), lim = c(0, 1), 
                     name = "Comprehension Vocabulary") +
  theme(legend.position = "bottom")
```

### Production

Production is measured both on Words and Gestures (WG) forms and Words and Sentences (WS) forms, though it is often at floor for younger children and so is not a reliable individual difference measure. 

```{r 3_production_wg}
wg_prod_data <- vocab_data %>%
  filter(form == "WG") %>%
  mutate(mean = production / n)

wg_prod_models <- wg_prod_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

wg_prod_preds <- wg_prod_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, wg_prod_models)) 

ggplot(wg_prod_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = wg_prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(name = "Age (months)", 
                     breaks = seq(8, 20, 4),
                     limits = c(8, 20)) +
  scale_y_continuous(breaks = c(0, .5, 1), lim = c(0, 1), 
                     name = "Production Vocabulary") +
  theme(legend.position = "bottom")
```

Words and Sentences

```{r 3_production_ws}
ws_prod_data <- vocab_data %>%
  filter(form == "WS") %>%
  mutate(mean = production / n)

ws_prod_models <- ws_prod_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

ws_prod_preds <- ws_prod_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, ws_prod_models)) 

ggplot(ws_prod_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .02) +
  geom_line(data = ws_prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(name = "Age (months)", 
                     breaks = seq(16, 36, 4),
                     limits = c(16, 36)) +
  scale_y_continuous(breaks = c(0, .5, 1), lim = c(0, 1), 
                     name = "Production Vocabulary") +
  theme(legend.position = "bottom")
```

Stiched across forms. See \@ref(appendix-stitching).

```{r 3_production_stitched}

```




## Quantifying Variability

One of the most important features of early vocabulary development is its variability [@fenson1994]. Consider the English production data from the Words and Sentences form.

```{r 3_eng_prod}
eng_prod_data <- vocab_data %>%
  filter(form == "WS", language == "English (American)") %>%
  mutate(mean = production)

eng_prod_model <- list()
eng_prod_model$`English (American)` <- eng_prod_data %>%
  fit_gcrq

eng_prod_preds <- eng_prod_data %>%
  group_by(age, language) %>%
  summarise(n = n()) %>%
  data.frame() %>% 
  pred_gcrq(eng_prod_model)

ggplot(eng_prod_data,
       aes(x = age, y = mean)) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = eng_prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(16, 30, 4),
                     limits = c(16, 30),
                     name = "Age (months)") +
  ylab("Production (Number of Words)") +
  ylim(c(0, 680)) + 
  theme(legend.position = "bottom")
```

It's immediately clear that there is tremendous variability in vocabulary. Consider just a single age group, 24-month-olds. The distribution of vocabularies across children is far from normally distributed, with many children at the very bottom of the scale and almost as many at the top. Quite a few two-year-olds on their second birthday are producing only a handful of words (or at least their parents say they are) and others are producing more than 600 listed on the form, with the total number higher than that even.^[It will quickly get tiresome to acknowledge ceiling effects and parent report biases in every sentence, so we will acknowledge them up front and then mention them only when relevant throughout.] 

```{r v_histogram}
ggplot(filter(eng_prod_data, age == 24), 
       aes(x = production)) + 
  geom_histogram(aes(y = ..density..), binwidth=30) + 
  geom_density(col = "red", aes(y = ..density..)) +
  xlim(0,680) + 
  xlab("Number of words produced")
```

One way to describe these data is to consider the relationship of the variance to the central tendency. The "coefficient of variation" (CV) is a common measure used for this purpose: 

$$CV = \frac{\sigma}{\mu}$$
This statistic allows standardized comparison of variability across measurements with different scales, an important concern when we want to compare forms with very different numbers of vocabulary items. For example, for two-year-olds, the mean productive vocabulary is `r round(mean(eng_prod_data$production[eng_prod_data$age == 24]))` words, and the standard deviation is `r round(sd(eng_prod_data$production[eng_prod_data$age == 24]))`, words, leading to a CV of `r signif(sd(eng_prod_data$production[eng_prod_data$age == 24])/mean(eng_prod_data$production[eng_prod_data$age == 24]), digits = 2)`. 

But, as seen in Figure \@ref(fig:v_histogram), the distribution of productive vocabulary scores is far from normal; this trend is even more apparent at the younger and older ages. Thus, a non-parametric approach is more appropriate. Accordingly, we compute the MADM statistic, the non-parametric equivalent of the CV. In MADM, the mean $\mu$ is replaced by the median ($m(x)$, and the standard deviation $\sigma$ is replaced by the mean absolute deviation (which captures how far away values are from the median):

$$MADM(x) = \frac{\frac{1}{n} \sum_{i = 1..n}{|x_i - m(x)|}}{m(x)}$$


```{r 3_madm1}

madm_data <- vocab_data %>%
  filter(form %in% c("WS","WG")) %>%
  group_by(language, form, age) %>%
  summarise(madm_p = madm(production), 
            madm_c = madm(comprehension),
            n = n()) %>%
  filter(n > 20) 

ggplot(filter(madm_data, language == "English (American)"), 
       aes(x = age, y = madm_p, col = form)) + 
  geom_point() + 
  geom_smooth(aes(group = 1)) + 
  ylim(0,2) +
  xlim(8,30) + 
  ylab("MADM (MAD / median)") + 
  xlab("Age (months)") + 
  scale_color_solarized(name = "Form")
```

In American English production, this ratio is actually close to 1 from age one until almost age two, suggesting that the standard *difference* from the median is actually as big as the median itself! The decline begins before variability is substantially truncated by the ceiling of the form, suggesting that variability between kids is really highest before the second birthday. 



Imagine groups of three children. A group where one produced 30 words, one produced 100, and another produced 170 would have a MADM of `r round(madm(c(33,100,180)), digits = 2)`. In contrast, one where they were more closely grouped -- say 70, 100, 130 -- would have a MADM of `r round(madm(c(70,100,130)), digits = 2)`.


The next figure shows MADM across languages and instruments. This similarity in variability structure is quite striking, such that between the first and second birthdays, language is remarkably variable.

```{r 3_madm2}
ggplot(madm_data, aes(x = age, y = madm_p, col = language)) + 
  geom_jitter(aes(size = n), alpha = 1) + 
  geom_smooth(aes(group  = 1)) + 
  ylim(0,2) + 
  ylab("MADM (Production)") + 
  xlab("Age (months)") + 
  scale_color_solarized(name = "") + 
  theme(legend.position = "bottom")
```

Yet this variability is quite *consistent*!

```{r 3_madm_summary}
madm_summary <- madm_data %>%
  filter(language != "Kigiriama") %>%
  group_by(language, form) %>%
  filter(age >= 12, age <= 24) %>%
  summarise(madm_mean = mean(madm_p), 
            madm_ci_lower = mean(madm_p) - ci.t(madm_p),
            madm_ci_upper = mean(madm_p) + ci.t(madm_p)) 

ggplot(madm_summary, aes(x = language, y = madm_mean, col = form)) + 
  geom_pointrange(aes(ymin = madm_ci_lower, ymax = madm_ci_upper), 
                  position = position_dodge(width = .1)) + 
  ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MADM (Production 12-24 mo)") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") + 
  geom_hline(aes(yintercept = 1), lty = 2, color = "gray")
```

```{r 3_madm_comprehension}
ggplot(filter(madm_data, form == "WG"), 
       aes(x = age, y = madm_c, col = language)) + 
  geom_jitter(aes(size = n), alpha = 1) + 
  geom_smooth(aes(group  = 1)) + 
  ylim(0,2) + 
  ylab("MADM (Comprehension)") + 
  xlab("Age (months)") + 
  scale_color_solarized(name = "") + 
  theme(legend.position = "bottom")
```

```{r 3_madm_summary}
madm_summary <- madm_data %>%
  filter(form == "WG", language != "Kigiriama") %>%
  group_by(language, form) %>%
  summarise(madm_mean = mean(madm_c), 
            madm_ci_lower = mean(madm_c) - ci.t(madm_c),
            madm_ci_upper = mean(madm_c) + ci.t(madm_c)) 

ggplot(madm_summary, aes(x = language, y = madm_mean)) + 
  geom_pointrange(aes(ymin = madm_ci_lower, ymax = madm_ci_upper)) + 
  ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MADM (Comprehension)") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") + 
  geom_hline(aes(yintercept = 1), lty = 2, color = "gray")
```



