# Vocabulary Development {#vocab}

## Abstract

This chapter focuses on a particular view of the data, namely that each child is represented by a single vocabulary score: the proportion of words that child knows out of the total in the form. We begin by examining quantify the nature of variability across individuals and languages. We also note differences in form ceilings across languages. Then, the bulk of this chapter is devoted to different demographic predictors of vocabulary growth across languages (following the EFAI approach). We compare the effects of gender (female advantage), birth order (first-born advantage), and maternal education (socioeconomic status – SES – advantage). 

## Variability in vocabulary development

```{r 3_vocab_admins}
num_words <- items %>%
  filter(type == "word") %>%
  group_by(language, form) %>%
  summarise(n = n())

vocab_data <- admins %>%
  select(data_id, language, form, age, sex, 
         mom_ed, birth_order, production, comprehension) %>% 
  left_join(num_words) %>%
  mutate(no_production = n - production)

min_age <- min(vocab_data$age)
max_age <- max(vocab_data$age)
```

```{r 3_models}
taus <-  c(0.1, 0.25, 0.5, 0.75, 0.9)
ages <- 8:18

fit_gcrq <- function(x) {
  mod <- try(gcrq(formula = mean ~ ps(age, monotone = 1, 
                                      lambda = 1000), 
                  tau = taus, data = x))
  
  if(inherits(mod, "try-error"))
  {
    return(NA)
  }
  
  return(mod)
}

pred_gcrq <- function(x, mods) {
  mod <- mods[[x$language[1]]]
  
  if (is.na(mod[1])) {
    return(expand.grid(age = x$age, 
                       language = x$language[1], 
                       percentile = as.character(taus*100), 
                       pred = NA))
  } else {
    preds <- predictQR_fixed(mod, 
                             newdata = x) %>%
      data.frame %>%
      mutate(age = x$age, 
             language = x$language) %>%
      gather(percentile, pred, starts_with("X")) %>%
      mutate(percentile = as.character(as.numeric(str_replace(percentile, 
                                                              "X", "")) 
                                       * 100))
    return(preds)
  }
}
```

One of the most important features of early vocabulary development is its variability [@fenson1994]. Consider the English production data from the Words and Sentences form.

```{r 3_eng_prod}
eng_prod_data <- vocab_data %>%
  filter(form == "WS", language == "English") %>%
  mutate(mean = production)

eng_prod_model <- list()
eng_prod_model$English <- eng_prod_data %>%
  fit_gcrq

eng_prod_preds <- eng_prod_data %>%
  group_by(age, language) %>%
  summarise(n = n()) %>%
  data.frame() %>% 
  pred_gcrq(eng_prod_model)

ggplot(eng_prod_data,
       aes(x = age, y = mean)) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = eng_prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(16, 30, 4),
                     limits = c(16, 30),
                     name = "Age (months)") +
  ylab("Production (Number of Words)") +
  ylim(c(0, 680)) + 
  theme(legend.position = "bottom")
```

It's immediately clear that there is tremendous variability in vocabulary. Consider just a single age group, two-year-olds (24 months). The distribution of vocabularies across children is far from normally-distributed, with many children at the very bottom of the scale and almost as many at the top. Quite a few two-year-olds on their second birthday are producing only a handful of words (or at least their parents say they are) and others are producing more than 600 listed on the form, with the total number higher than that even.^[It will quickly get tiresome to acknowledge ceiling effects and parent report biases in every sentence, so we will acknowledge them up front and then mention them only when relevant throughout.] 

```{r}
ggplot(filter(eng_prod_data, age == 24), 
       aes(x = production)) + 
  geom_histogram(aes(y = ..density..), binwidth=30) + 
  geom_density(col = "red", aes(y = ..density..)) +
  xlim(0,680) + 
  xlab("Number of words produced")
       
```

One way to describe these data is to consider the relationship of the variance to the central tendency. For example, in this age group, the mean productive vocabulary is `r round(mean(eng_prod_data$production[eng_prod_data$age == 24]))` words, and the standard deviation is `r round(sd(eng_prod_data$production[eng_prod_data$age == 24]))` words. But this distribution is far from normal (especially at the younger and older ages), so a non-parametric approach is warranted. We can  compute the median absolute deviation from the median (MAD), which captures how far away values are from the median (a measure of variance, similar to the inter-quantile range or IQR) and divide by the median itself, giving us an intuitive sense of how the spread of the data relates to the central tendency. We'll call this number the MMAD.

```{r 3_madm1}
mmad <- function(x) {median(x) / mad(x) }
madm <- function(x) {mad(x) / median(x) }

m_sd <- vocab_data %>%
  filter(language == "English") %>%
  group_by(form, age) %>%
  summarise(median = median(production), 
            mad = mad(production), 
            ratio = median / mad)

ggplot(m_sd, aes(x = age, y = ratio, col = form)) + 
  geom_line() + 
  ylim(0,2) + 
  xlim(8,30) + 
  ylab("MADM (median / MAD)") + 
  xlab("Age (months)")
```

In English production, this ratio is actually close to 1 from age one until almost age two, suggesting that the standard *difference* from the median is actually as big as the median itself! The decline begins before variability is substantially truncated by the ceiling of the form, suggesting that variability between kids is really highest before the second birthday. The same pattern is generally found across the languages in our database, with very high variance between the first and second birthdays. What does this MADM measure mean, exactly? It's a non-parametric version of Cohen's $d$. In fact, they are very highly correlated. 

```{r 3_madm_normal}
madm_ratio <- vocab_data %>%
  group_by(language, form, age) %>%
  filter(n() > 20) %>%
  summarise(median = median(production), 
            mad = mad(production), 
            ratio = median / mad, 
            cov_madm = mad / median,
            normal_ratio = mean(production) / sd(production) )

qplot(ratio, normal_ratio, 
      data = madm_ratio, geom = c("point","smooth")) + 
  ylim(0,3) + xlim(0,3) + 
  geom_abline(lty = 2) + 
  ylab("Cohen's d") + 
  xlab("MADM")
```

Imagine groups of three children. A group where one produced 30 words, one produced 100, and another produced 170 would have a MADM of `r round(madm(c(33,100,180)), digits = 2)`. In contrast, one where they were more closely grouped -- say 70, 100, 130 -- would have a MADM of `r round(madm(c(70,100,130)), digits = 2)`.

```{r 3_madm2}

ggplot(madm_ratio, aes(x = age, y = ratio, col = language)) + 
  geom_jitter(size = 1, alpha = 1) + 
  geom_smooth(aes(group  = 1)) + 
  ylim(0,2) + 
  ylab("median / MAD") + 
  xlab("Age (months)") + 
  scale_color_discrete(guide = FALSE)
```

```{r 3_madm3}

ggplot(madm_ratio, aes(x = age, y = cov_madm, col = language)) + 
  geom_jitter(size = 1, alpha = 1) + 
  geom_smooth(aes(group  = 1)) + 
  ylim(0,1.6) + 
  ylab("MAD / median") + 
  xlab("Age (months)") + 
  scale_color_discrete(guide = FALSE)
```

The next figure shows MADM across languages and instruments. This similarity in variability structure is quite striking, such that between the first and second birthdays, language is remarkably variable. Below, we will use this variability as a way to measure the size of demographic effects. For example, how much variability is due to gender, compared with simple population variability?



## Norms

This set of analyses examines general patterns of vocabulary development. 


Here we examine general patterns of variability across languages. 

### Comprehension


```{r 3_comprehension}
comp_data <- vocab_data %>%
  filter(form == "WG") %>%
  mutate(mean = comprehension / n)

comp_models <- comp_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

comp_preds <- comp_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, comp_models)) 

ggplot(comp_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = comp_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(8, 18, 4),
                     limits = c(8, 18),
                     name = "Age (months)") +
  ylab("Comprehension Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```

### Production

Words and Gestures.

```{r 3_production_wg}
prod_data <- vocab_data %>%
  filter(form == "WG") %>%
  mutate(mean = production / n)

prod_models <- prod_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

prod_preds <- prod_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, prod_models)) 

ggplot(prod_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .1) +
  geom_line(data = prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(8, 36, 4),
                     limits = c(8, 36),
                     name = "Age (months)") +
  ylab("Production Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```

Words and Sentences

```{r 3_production_ws}
prod_data <- vocab_data %>%
  filter(form == "WS") %>%
  mutate(mean = production / n)

prod_models <- prod_data %>%
  split(.$language) %>%
  map(fit_gcrq) 

prod_preds <- prod_data %>%
  group_by(language, age) %>%
  summarise(n = n()) %>%
  data.frame() %>%
  split(.$language) %>%
  map_df(function(x) pred_gcrq(x, prod_models)) 

ggplot(prod_data,
       aes(x = age, y = mean)) +
  facet_wrap(~language) +
  geom_jitter(width = .4, size = 1, alpha = .05) +
  geom_line(data = prod_preds, 
            aes(y = pred, col = percentile, group = percentile)) + 
  scale_colour_solarized(name="Percentile") +
  scale_x_continuous(breaks = seq(16, 36, 4),
                     limits = c(16, 36),
                     name = "Age (months)") +
  ylab("Production Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) + 
  theme(legend.position = "bottom")
```


### Comparions of Variability on Comprehension and Production


