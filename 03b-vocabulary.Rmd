# Demographic Variables {#demographics}

Chapter \@ref(vocab) examined differences across languages in the distribution of children's reported vocabulary.  In this chapter, we follow up these analyses by beginning the process -- which will span throughout the book -- of attempting to understand the nature and sources of these differences. In particular, we take advantage of the sample diversity described in Chapter \@ref(methods) to explore differences in the median trajectory of vocabulary growth within demographic groups, focusing on three variables that are relatively available in our data: sex, maternal education, and birth order, and develop a framework for comparing the magnitude of these effects.

One important tension in this chapter reflects many earlier discussions of variability in CDI scores [from @fenson1994, @feldman2000, and @eriksson2012, among others]. While some demographic differences in vocabulary are quite consistent -- substantially so, as it turns out -- the overall proportion of variance in vocabulary that they capture is still relatively limited. We will examine a number of different perspectives on how to quantify this relationship, moving back and forth between emphasizizing consistency in differences in the central tendency and emphasizing the limited size of these effects relative to the variability documented in Chapter \@ref(vocab).

Our analyses in this chapter are unfortunately limited to a subset of languages, as demographic data for many contributed datasets were not available. We begin with sex, the variable for which the most analysis has already been done and for which we have the most data, then move on to birth order and finally maternal education. 

```{r 3b_vocab_admins}
num_words <- items %>%
  filter(type == "word") %>%
  group_by(language, form) %>%
  summarise(n = n())

vocab_data <- admins %>%
  dplyr::select(data_id, language, form, age, sex, 
                mom_ed, birth_order, production, comprehension) %>% 
  left_join(num_words) %>%
  mutate(no_production = n - production)

min_age <- min(vocab_data$age)
max_age <- max(vocab_data$age)
```

## Sex

Our first analysis examines how vocabulary development differs by children's sex.^[Throughout, we will assume that parents report on children's biological sex, rather than their gender identity.] The literature on cognitive differences due to sex is vast, controversial in many places, and difficult to summarize [see @miller2014 for a useful recent review]. Focusing on development, @maccoby1974 began the enterprise of systematizing and summarizing gender differences. Their conclusions were largely deflationary but did suggest some differences in aggression and verbal ability (which were suggested to emerge in the period of early adolescence). This latter claim is most relevant for our analysis, but has been subject to controversy as well. Using meta-analytic tools, @hyde1988 found that differences in verbal ability were minimal, but more recent studies have suggested consistent verbal ability differences. For example, @stoet2013 found differences in reading ability across nations in a massive elementary education dataset (the PISA assessment), with variance in the magnitude of difference but girls very consistently showing an advantage. Similarly, @robinson2011 reported consistent differences in reading ability (favoring girls) at the onset of kindergarten in a nationally-representative US sample. 

It almost goes without saying that these findings are subject to the full range of possible explanations articulated in the literature. These range from caregiver and academic socialization (e.g., self-fulfilling expectations that girls are more verbal) to "self socialization" in which affiliative differences produce differences in behavior, all the way to biological explanations.^[As an illustrative example, some literature has implicated fetal testosterone, though by a  @lutchmaya2001 used CDI meausures and recovered an effect somewhat similar to ours with a small sample ($d = .64$ at 18 months with $N=87$), and $d = .60$ at 24 months for a subsample). They found some relationship with fetal testosterone across sexes, but it did not hold up within sex (perhaps due to small samples). The mechanism by which testosterone translates into vocabulary growth is unclear however.] While descriptive data of the type cited above (and reported in our analyses below) can be more or less consistent with some of these theories, conclusive evidence will not be forthcoming.

Our analyses below replicate and extend the results of @eriksson2012, who used an overlapping sample of CDI data from 12 languages to explore sex effects on vocabulary size.^[An earlier version of this analysis was reported in @frank2016.] 

### Comprehension

We begin by examining Words and Gestures data on comprehension. 


```{r 3_gender_plot_WG}
wg_sex_data <- vocab_data %>%
  filter(!is.na(sex), form == "WG") %>%
  mutate(no_comprehension = n - comprehension)

wg_sex_means <- wg_sex_data %>%
  group_by(language, sex, age) %>%
  summarise(median = median(comprehension/n))

wg_sex_models <- wg_sex_data %>%
  split(.$language) %>%
  map(function(x) {
    robustbase::glmrob(cbind(comprehension, no_comprehension) ~ age * sex - sex,
                       family = "binomial",
                       data = x)
  })

wg_sex_preds <- expand.grid(language = unique(wg_sex_means$language),
                            age = min_age:max_age,
                            sex = unique(wg_sex_means$sex)) %>%
  split(.$language) %>%
  map_df(function(x) {
    x$pred <- predict(wg_sex_models[[x$language[1]]],
                      newdata = x, type = "response")
    return(x)
  })

ggplot(wg_sex_means,
       aes(x = age, y = median, colour = sex, label = sex)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = wg_sex_preds, aes(y = pred)) +
  scale_colour_solarized(name="Sex") +
  scale_x_continuous(breaks = seq(8,
                                  20, 4),
                     limits = c(8, 20),
                     name = "Age (months)") +
  scale_y_continuous(breaks = c(0,.5,1), limits = c(0,1), 
                     name = "Median Comprehension Vocabulary (proportion)") +
  theme(legend.position = "bottom")
```

Our first plot shows comprehension on Words and Gestures. Visual inspection of the data suggest limited differences, but a female advantage in some languages (most pronounced in Korean, Latvian, and Hebrew). Note that many authors do not find gender  differences in early comprehension [e.g., @eriksson2012]. @feldman2000 also did not using a large, relatively representative American dataset, though they had data only from younger children (10-13 months). 

```{r}
model_summary <- wg_sex_models %>%
  map_df(function(x) {
    p <- summary(x)$coefficients['age:sexMale','Pr(>|z|)']
    beta <- summary(x)$coefficients['age:sexMale','Estimate']
    return(data_frame(beta_male = round(beta, 4), 
                      p = round(p, 4)))
  }) %>%
  mutate(language = names(wg_sex_models)) %>% # ugly 
  select(language, beta_male, p) %>%
  arrange(beta_male)

model_summary %>%
  datatable
```
We can examine the statistical models to get a clearer picture. For each language, we fit a robust generalized linear model predicting vocabulary size (number of words understood out of the total) predicted by age, and the interaction of age and gender. We specified this simple model so that the coefficient estimate on the age by gender interaction provides a convenient summary of the difference in vocabulary growth across groups. Despite the small magnitudes of the coefficients, `r nrow(filter(model_summary, p < .05, beta_male < 0))` of `r nrow(model_summary)` languages had a female advantage. In contrast, `r nrow(filter(model_summary, p < .05, beta_male > 0))` showed a male advantage and the remainder did not show a significant gender by age interaction. 

Moving away from the model-based method above, we can look for a measure of effect size (similar to that used in the previous chapter). Effect size quantifies the size of the difference between groups in terms of the variability, producing a scale-free measure of difference that is appropriate for comparison across languages. Normally we'd use a measure like Cohen's $d$ here, where

$$d = \frac{\mu_2 - \mu_1}{SD_{pooled}}$$

But as in the previous chapter, we have the problem of non-normal distributions. To circumvent this issue, we use a non-parametric measure derived from the same components:  the difference between medians, divided by the MAD. (We call this the MMAD). 

```{r 3b_gender_mmad_wg_comp}
gender_mmad_ratio_wg <- vocab_data %>%
  filter(form == "WG", !is.na(sex)) %>%
  group_by(language, age, sex) %>%
  filter(n() > 10) %>%
  summarise(median_comp = median(comprehension),
            mad_comp = mad(comprehension),
            n = n()) %>%
  group_by(language, age) %>%
  filter(n() >= 2) %>% # more than 2 in each sex
  summarise(mmad = (median_comp[sex == "Female"] - median_comp[sex == "Male"]) / mean(mad_comp),
            n = sum(n)) %>%
  filter(is.finite(mmad)) 

ggplot(gender_mmad_ratio_wg,
       aes(x = age, y = mmad, col = language)) +
  geom_jitter() +
  geom_smooth(span = 1, aes(group = 1)) +
  geom_hline(yintercept = 0, lty = 2, col = "gray") + 
  scale_color_solarized() + 
  xlab("Age (months)")  + 
  ylab("MMAD (Female Advantage)")
```

```{r}
gender_mmad_summary_wg <- gender_mmad_ratio_wg %>%
  group_by(language) %>%
  summarise(mmad_mean = weighted.mean(mmad, w = n),
            n = n()) %>%
  filter(n > 4) %>% # more than four age points - FIXME, arbitrary
  mutate(language = fct_reorder(language, mmad_mean))

ggplot(gender_mmad_summary_wg, aes(x = language, y = mmad_mean)) + 
  geom_point() + 
  # geom_pointrange(aes(ymin = mmad_ci_lower, ymax = mmad_ci_upper)) + 
  # ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MMAD (Comprehension)") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") 
```
Applying this measure to the data on comprehension, we see a quite small average female advantage that appears relatively constant across age. For those languages with dense enough data, we can take a weighted average of this pattern across ages, which reveals substantial variability. The overall median for these `r nrow(gender_mmad_summary_wg)` languages is quite small as well, `r round(median(gender_mmad_summary_wg$mmad_mean),2)`. In summary, there is some evidence for a modest female advantage in comprehension. 


### Production (Words and Gestures)


```{r 3_gender_plot_WG_prod}
wg_sex_data_prod <- vocab_data %>%
  filter(!is.na(sex), form == "WG") 

wg_sex_means_prod  <- wg_sex_data %>%
  group_by(language, sex, age) %>%
  summarise(median = median(production/n))

wg_sex_models_prod  <- wg_sex_data_prod  %>%
  split(.$language) %>%
  map(function(x) {
    robustbase::glmrob(cbind(production, no_production) ~ age * sex - sex,
                       family = "binomial",
                       data = x)
  })

wg_sex_preds_prod  <- expand.grid(language = unique(wg_sex_means_prod $language),
                                  age = min_age:max_age,
                                  sex = unique(wg_sex_means$sex)) %>%
  split(.$language) %>%
  map_df(function(x) {
    x$pred <- predict(wg_sex_models_prod[[x$language[1]]],
                      newdata = x, type = "response")
    return(x)
  })

ggplot(wg_sex_means_prod,
       aes(x = age, y = median, colour = sex, label = sex)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = wg_sex_preds_prod, aes(y = pred)) +
  scale_colour_solarized(name="Sex") +
  scale_x_continuous(breaks = seq(8,
                                  20, 4),
                     limits = c(8, 20),
                     name = "Age (months)") +
  scale_y_continuous(breaks = c(0,.5,1), limits = c(0,1), 
                     name = "Median Production Vocabulary (proportion)") +
  theme(legend.position = "bottom")
```


```{r}
model_summary <- wg_sex_models_prod %>%
  map_df(function(x) {
    p <- summary(x)$coefficients['age:sexMale','Pr(>|z|)']
    beta <- summary(x)$coefficients['age:sexMale','Estimate']
    return(data_frame(beta_male = round(beta, 4), 
                      p = round(p, 4)))
  }) %>%
  mutate(language = names(wg_sex_models)) %>% # ugly 
  select(language, beta_male, p) %>%
  arrange(beta_male)

model_summary %>%
  datatable
```
We next turn to production data. As in many of our subsequent analyses, data on production from Words and Gestures forms tend to be at floor, so they are of limited utility and the faiulure to find differences may reflect floor effects rather than any true differences. Visual inspection confirms differences at the edge of the age range covered by Words and Gestures forms, however, so for completeness we give the comparable statistical analyses as above. Here `r nrow(filter(model_summary, p < .05, beta_male < 0))` of `r nrow(model_summary)` languages show a statistically significant female advantage.

```{r 3b_gender_mmad_wg_prod}
gender_mmad_ratio_wg_prod <- vocab_data %>%
  filter(form == "WG", !is.na(sex)) %>%
  group_by(language, age, sex) %>%
  filter(n() > 10) %>%
  summarise(median_prod = median(production),
            mad_prod = mad(production),
            n = n()) %>%
  group_by(language, age) %>%
  filter(n() >= 2) %>% # more than 2 in each sex
  summarise(mmad = (median_prod[sex == "Female"] - median_prod[sex == "Male"]) / mean(mad_prod),
            n = sum(n)) %>%
  filter(is.finite(mmad)) 

gender_mmad_summary_wg_prod <- gender_mmad_ratio_wg_prod %>%
  group_by(language) %>%
  summarise(mmad_mean = weighted.mean(mmad, w = n),
            n = n()) %>%
  filter(n > 4) %>% # more than four age points - FIXME, arbitrary
  mutate(language = fct_reorder(language, mmad_mean))

a <- ggplot(gender_mmad_ratio_wg_prod,
            aes(x = age, y = mmad, col = language)) +
  geom_jitter() +
  geom_smooth(span = 1, aes(group = 1)) +
  geom_hline(yintercept = 0, lty = 2, col = "gray") + 
  scale_color_solarized() + 
  xlab("Age (months)")  + 
  ylab("MMAD (Female Advantage)") + 
  theme(legend.position = "bottom") 

b <- ggplot(gender_mmad_summary_wg_prod, aes(x = language, y = mmad_mean)) + 
  geom_point() + 
  # geom_pointrange(aes(ymin = mmad_ci_lower, ymax = mmad_ci_upper)) + 
  # ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MMAD (Production)") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") 

grid.arrange(a, b, ncol=2)
```

Examining the MMAD effect size measures, it is clear that there is limited signal in early production but the overall trend appears to be for a slight developmental increase from around 12 - 20 months.  In addition, overall effect sizes are larger than in comprehension, with a median effect of `r round(median(gender_mmad_summary_wg_prod$mmad_mean),2)`, though in this analysis, averaging across age may be less warranted.

### Production (Words and Sentences)

```{r 3_gender_plot_ws_prod}
sex_data <- vocab_data %>%
  filter(!is.na(sex), form == "WS")

sex_means <- sex_data %>%
  group_by(language, sex, age) %>%
  summarise(median = median(production/n))

fit_sex <- function(x) {
  robustbase::glmrob(cbind(production, no_production) ~ age * sex - sex,
                     family = "binomial",
                     data = x)
}

pred_sex <- function(x) {
  x$pred <- predict(sex_models[[x$language[1]]],
                    newdata = x, type = "response")
  return(x)
}

sex_models <- sex_data %>%
  split(.$language) %>%
  map(fit_sex)

sex_preds <- expand.grid(language = unique(sex_means$language),
                         age = min_age:max_age,
                         sex = unique(sex_means$sex)) %>%
  split(.$language) %>%
  map_df(pred_sex)

ggplot(sex_means,
       aes(x = age, y = median, colour = sex, label = sex)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = sex_preds, aes(y = pred)) +
  scale_colour_solarized(name="Sex") +
  scale_x_continuous(breaks = seq(16,
                                  36, 8),
                     limits = c(16, 36),
                     name = "Age (months)") +
  scale_y_continuous(breaks = c(0,.5,1), limits = c(0,1), 
                     name = "Median Production Vocabulary (proportion)") +
  theme(legend.position = "bottom")
```

```{r}
model_summary <- sex_models %>%
  map_df(function(x) {
    p <- summary(x)$coefficients['age:sexMale','Pr(>|z|)']
    beta <- summary(x)$coefficients['age:sexMale','Estimate']
    return(data_frame(beta_male = round(beta, 4), 
                      p = round(p, 4)))
  }) %>%
  mutate(language = names(sex_models)) %>% # ugly 
  select(language, beta_male, p) %>%
  arrange(beta_male)

model_summary %>%
  datatable
```

We next turn to production data on the Words and Sentences instrument, which we expect to be much more informative regarding production.  Visual inspection confirms differences in almost every case, and an analysis of the fitted models shows that `r nrow(filter(model_summary, p < .05, beta_male < 0))` of `r nrow(model_summary)` languages show a statistically significant female advantage!

```{r 3b_gender_mmad_ws_prod}
gender_mmad_ratio <- vocab_data %>%
  filter(form == "WS") %>%
  filter(!is.na(sex)) %>%
  group_by(language, age, sex) %>%
  filter(n() > 10) %>%
  summarise(median_prod = median(production),
            mad_prod = mad(production),
            n = n()) %>%
  group_by(language, age) %>%
  filter(n() >= 2) %>% # more than 2 in each sex
  summarise(mmad = (median_prod[sex == "Female"] - median_prod[sex == "Male"]) / mean(mad_prod),
            n = sum(n)) %>%
  filter(is.finite(mmad)) 

gender_mmad_summary <- gender_mmad_ratio %>%
  group_by(language) %>%
  summarise(mmad_mean = weighted.mean(mmad, w = n),
            n = n()) %>%
  filter(n > 4) %>% # more than four age points - FIXME, arbitrary
  mutate(language = fct_reorder(language, mmad_mean))

a <- ggplot(gender_mmad_ratio,
            aes(x = age, y = mmad, col = language)) +
  geom_jitter() +
  geom_smooth(span = 1, aes(group = 1)) +
  geom_hline(yintercept = 0, lty = 2, col = "gray") + 
  scale_color_solarized() + 
  xlab("Age (months)")  + 
  ylab("MMAD (Female Advantage)") + 
  theme(legend.position = "bottom") 

b <- ggplot(gender_mmad_summary, aes(x = language, y = mmad_mean)) + 
  geom_point() + 
  # geom_pointrange(aes(ymin = mmad_ci_lower, ymax = mmad_ci_upper)) + 
  # ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MMAD (Production)") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") 

grid.arrange(a, b, ncol=2)
```

We next turn to the MMAD effect size measure. Here we see a relatively consistent difference across ages with perhaps a slight downward trend in effect size. This downward trend might be a function of ceiling effects on the form, however, as seen in the model-fit curves above for, e.g., Danish. When variability is limited by the form ceiling, effect size estimates will necessarily be depressed. The median female advantage is `r round(median(gender_mmad_summary$mmad_mean),2)`, substantially larger than that seen in early comprehension and somewhat larger than that seen in early production (perhaps due to floor effects early on). 

### Reporting Bias?

Do these differences reflect differences in measurement that are unique to the CDI? One way of addressing this question is to examine other studies of ex that have been found in other studies. Unfortunately, many of the studies reporting differences themselves rely on the CDI, likely for the reasons reviewed in Chapter \@ref(intro), e.g. [@bauer2002,@fenson1994,@feldman2000]. For exmaple, @feldman2000 collects CDIs with a large dataset of low-income American English speakers around 12 and 24 months. In those data, early comprehension showed no significant difference but production at 24 months showed a difference comparable to what we observed ($N = 2156$, $d = .35$, recomputed from provided summary statistics). These data, while providing replication in an independent dataset, do not speak to whether reporting biases contributed to or created the observed sex effects. 

For external validation, we turn to two other studies that provide more objective (non parent-report) measurements of early language. First, a seminal study by @huttenlocher1991 measured gender effects in vocabulary size as estimated from a naturalistic sample of production and found substantial differences in vocabulary growth favoring girls. Although the measurements from this study are not comparable, the effects are quite large (and are relatively unaffected by controlling for maternal language exposure). 


```{r 3b_bornstein}
b2012 <- read_csv("data/bornstein2012/bornstein2012_combined.csv")
nrow(b2012)

qplot(z_20, z_48, col = gender, pch = gender, data = b2012) +
  scale_color_solarized() + 
  xlab("Standardized Language at 20 Months") + 
  ylab("Standardized Language at 48 Months") + 
  geom_smooth(method = "lm")

b2012_summary <- b2012 %>%
  group_by(gender) %>%
  do(data.frame(rbind(smean.cl.boot(.$z_20))))
```

Second, @bornstein2012 use a particularly powerful study design to examine stability in early language estimates across different measures. They gathererd longitudinal data at 20 and 48 months using a wide range of standardized and parent-report measures, and then use structural equation modeling to model shared variance due to parent report as well as standardized latent language ability at each age. We digitized data from their Figure 2 to examine the size of the gender differences in the latent vocabulary construct that they recovered.^[These data are not perfect, I have double-digitized one point.] As these scores are standardized, we can examine the difference in means and recover the standardized effect size for gender in the data, which is `r round(-diff(b2012_summary$Mean), 2)` standard deviations. Since this measurement is *greater* than that found in the CDI measurements for our study (the comparable American English measurement was `r round(filter(gender_mmad_summary, language == "English (American)") %>% pull(mmad_mean), 2)`), we doubt that our observed effect is due solely to reporting bias. 

### Discussion

In summary, we found a considerable and strikingly consistent cross-linguistic female advantage in early language production [replicating and extennding @eriksson2012]. A much smaller but still relatively consistent female advantage was reported in comprehension. We suspect that neither of these effects are due to parental reporting bias. First, our review of the literature suggests that more objective measures yield similar effects to the extent that we were able to compare. Second, comprehension is very likely to be the measure *more* affected by reporting biases as it is likely to be more subjective [@feldman2000;@fenson2000]. In contrast, we find a much smaller effect in comprehension. As noted above, we remain agnostic about the causes of these differences, but in Chapter \@ref(conclusion) we discuss inferences from consistency across languages in much more detail.

## Maternal education

From health to education, children from lower socioeconomic status (SES) backgrounds tend to be at higher risk for a variety of negative developmental outcomes, compared to their higher-SES peers (Bradley & Corwin, 2002). A large literature documents specific relations between SES and children’s early language abilities, especially oral vocabulary, which is in turn related to outcomes when children begin formal education (e.g., Durham et al., 2007; Hart & Risley, 2006; Hoff, 2002; Marchman & Fernald, 2008). Environmental explanations of these SES effects are often given in terms of indirect factors that affect life opportunities or experiences, such as nutrition and access to health care, as well as more direct factors that impact daily life, such as smoking during pregnancy, access to quality child care, or amount of time caregivers spend in interactions with their young children. Alternatively, even early language shows a significant genetic component, raising the possibility that SES-vocabulary links may instead be genetically mediated (Hayiou-Thomas et al., 2012). 

Cross-national comparisons may shed light on the factors that lead to relations between SES and children’s vocabulary outcomes. On the one hand, relatively constant relations across language communities that vary widely in indirect and direct factors that shape learning would provide prima facie support for genetic explanations. In contrast, a greater degree of cross-national variability would point to the origins of SES effects in aspects of children’s early environments that vary with SES to differing degrees across countries (e.g., Siddiqi et al., 2007; L. C. H. Fernald et al., 2012). Our current study addresses this issue in very young children using data from the MacArthur-Bates Communicative Development Inventories (MB-CDI), a family of reliable and valid parent-report instruments for measuring early vocabulary development in children under 3 years (Fenson et al., 2007). We take advantage of Wordbank, a new database of more than 10,000 MB-CDI instruments from six countries (Frank et al., 2016).  We use maternal education as a proxy for SES, following previous work suggesting that maternal education is strongly related to SES variation (Bornstein et al., 2003; Hoff, 2002). 


@arriaga2000

We use maternal education as a proxy for socio-economic status.

```{r 3_mom_ed_wg}
wg_ses_data <- vocab_data %>%
  filter(!is.na(mom_ed), form == "WG") %>%
  mutate(mom_ed = fct_collapse(mom_ed,
                               `Below Secondary` = c("None","Primary",
                                                     "Some Secondary"),
                               `Secondary` = c("Secondary", "Some College"),
                               `College and Above` = c("College",
                                                       "Some Graduate",
                                                       "Graduate")), 
         no_comprehension = n - comprehension)

wg_ses_means <- wg_ses_data %>%
  group_by(language, mom_ed, age) %>%
  summarise(median = median(comprehension/n))

wg_ses_models <- wg_ses_data %>%
  split(.$language) %>%
  map( function(x) {
    robustbase::glmrob(cbind(comprehension, no_comprehension) ~
                         age * mom_ed  - mom_ed,
                       family = "binomial",
                       data = x)
  })

wg_ses_preds <- expand.grid(language = unique(wg_ses_means$language),
                            age = min_age:max_age,
                            mom_ed = unique(wg_ses_means$mom_ed)) %>%
  split(.$language) %>%
  map_df(function(x) {
    x$pred <- predict(wg_ses_models[[x$language[1]]],
                      newdata = x, type = "response")
    return(x)
  })

ggplot(wg_ses_means,
       aes(x = age, y = median, colour = mom_ed, label = mom_ed)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = wg_ses_preds, aes(y = pred)) +
  scale_colour_solarized(name="Maternal Education") +
  scale_x_continuous(breaks = seq(min(wg_ses_means$age),
                                  max(wg_ses_means$age), 4),
                     limits = c(min(wg_ses_means$age), max(wg_ses_means$age)),
                     name = "Age (months)") +
  ylab("Median Productive Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) +
  theme(legend.position = "bottom")
```

WS Production

```{r 3_mom_ed_ws}
ses_data <- vocab_data %>%
  filter(!is.na(mom_ed), form == "WS") %>%
  mutate(mom_ed = fct_collapse(mom_ed,
                               `Below Secondary` = c("None","Primary",
                                                     "Some Secondary"),
                               `Secondary` = c("Secondary", "Some College"),
                               `College and Above` = c("College",
                                                       "Some Graduate",
                                                       "Graduate")))

ses_means <- ses_data %>%
  group_by(language, mom_ed, age) %>%
  summarise(median = median(production/n))

fit_ses <- function(x) {
  robustbase::glmrob(cbind(production, no_production) ~
                       age * mom_ed  - mom_ed,
                     family = "binomial",
                     data = x)
}

pred_ses <- function(x) {
  x$pred <- predict(ses_models[[x$language[1]]],
                    newdata = x, type = "response")
  return(x)
}

ses_models <- ses_data %>%
  split(.$language) %>%
  map(fit_ses)

ses_preds <- expand.grid(language = unique(ses_means$language),
                         age = min_age:max_age,
                         mom_ed = unique(ses_means$mom_ed)) %>%
  split(.$language) %>%
  map_df(pred_ses)

ggplot(ses_means,
       aes(x = age, y = median, colour = mom_ed, label = mom_ed)) +
  facet_wrap(~language) +
  geom_point(alpha=.2) +
  geom_line(data = ses_preds, aes(y = pred)) +
  scale_colour_solarized(name="Maternal Education") +
  scale_x_continuous(breaks = seq(min(ses_means$age),
                                  max(ses_means$age), 4),
                     limits = c(min(ses_means$age), max(ses_means$age)),
                     name = "Age (months)") +
  ylab("Median Productive Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) +
  theme(legend.position = "bottom")
```

```{r 3b_ses_mmad}
ses_mmad_ratio <- ses_data %>%
  group_by(language, form, age, mom_ed) %>%
  filter(n() > 5) %>% # FIXME - arbirtary
  summarise(median_prod = median(production),
            mad_prod = mad(production),
            n = n()) %>%
  group_by(language, form, age) %>%
  filter(sum(mom_ed == "College and Above") > 0, 
         sum(mom_ed == "Secondary") > 0) %>% # more than 2 in each gender group
  summarise(mmad = (median_prod[mom_ed == "College and Above"] - 
                      median_prod[mom_ed == "Secondary"]) / mean(mad_prod)) %>%
  filter(is.finite(mmad)) 

ggplot(ses_mmad_ratio,
       aes(x = age, y = mmad, col = language)) +
  geom_jitter() +
  geom_smooth(span = 1, aes(group = 1)) +
  scale_color_solarized()
```

Visualize variability. 

```{r}
ses_mmad_summary <- ses_mmad_ratio %>%
  group_by(language) %>%
  summarise(mmad_mean = mean(mmad), 
            mmad_ci_lower = mean(mmad) - ci.t(mmad),
            mmad_ci_upper = mean(mmad) + ci.t(mmad), 
            n = n()) %>%
  filter(n > 4) # more than four age points - FIXME, arbitrary

ggplot(ses_mmad_summary, aes(x = language, y = mmad_mean)) + 
  geom_pointrange(aes(ymin = mmad_ci_lower, ymax = mmad_ci_upper)) + 
  # ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MMAD") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") + 
  geom_hline(aes(yintercept = 1), lty = 2, color = "gray")
```

### Explanations

Our findings show that the relations between maternal education and children’s vocabulary outcomes is highly variable across countries. The observational nature of our data precludes strong inferences about the precise factors that lead to these differences, though speculation is certainly possible. The large magnitude of the differences across countries suggests a powerful role for environmental factors in shaping variation in child outcomes even before the age of 3 years. Findings from the present study support the proposal that inequalities in factors that are linked to child well being should be addressed early in life. Since features of the quantity and quality of caregiver linguistic input has been strongly implicated in early language development, future research should focus on policy interventions that facilitate children’s access to  high quality talk by caregivers, including care availability and parental leave. 

### Reporting biases

> The data suggest that different scales of the CDI may be susceptible to differential reporting biases in different subgroups of the population. On CDI sec- tions that require considerable subjective interpreta- tion of observations, parents with low educational and income levels, who were underrepresented in the CDI norming sample, seem to overestimate their child’s abilities in comparison with parents with more education and income. For example, the Phrase and Vocabulary Comprehension sections of the CDI-WG require parents to make potentially difficult judg-
ments about their children’s levels of understanding. Negative correlations were found between scores on both of these sections and maternal education and health insurance status. Parents in general may have difficulty in distinguishing between comprehension that is based solely on verbal input and comprehen- sion that is based on a variety of nonlinguistic cues and contextual supports to meaning (Chapman, 1978). Some parents may recall times when the words were used in the child’s presence and may confuse ex- posure with understanding. Some may credit the child with comprehension if the child seems to under- stand the word in a highly constrained situation. These difficulties may explain why parental reports of verbal comprehension in this age range are higher than results of direct testing (Tomasello & Mervis 1994). They also may explain why correlations be- tween parental reports and comprehension scores from other methods are extremely low (Reznick, 1990). 

One discussion in @feldman2000 and @fenson1993 is that there may be reporting biases, particularly in comprehension, for children in the youngest age groups. 

@reznick1990 also found a negative correlation between SES and vocabulary in a subgroup analysis.

We examine reported comprehension vocabulary 

```{r}
early_comprehension <- wg_ses_data %>%
  filter(age < 13) %>%
  group_by(language, mom_ed, age) %>%
  summarise(median = median(comprehension / n), 
            n = n())

ggplot(early_comprehension, 
       aes(x = age, y = median, col = mom_ed)) + 
  geom_point(aes(size = n), position = "dodge") + 
  facet_wrap(~language) + 
  scale_color_solarized() +
  geom_smooth(se=FALSE, span = 2)
# geom_smooth(method = "lm", se = FALSE, formula = y ~ x)
```


## Birth order

Only `r length(unique(filter(vocab_data,!is.na(birth_order))$language))` languages have birth order data, and only `r length(unique(filter(vocab_data,!is.na(birth_order), form == "WS")$language))` languages have it for WS.

```{r 3_birth_order}
ord_data <- vocab_data %>%
  filter(!is.na(birth_order), form == "WS") %>%
  filter(language != "Spanish") %>% # FIXME - birth order data wacky
  mutate(birth_order = fct_collapse(birth_order,
                                    "Third+" = c("Third","Fourth",
                                                 "Fifth","Sixth",
                                                 "Seventh","Eighth")))

ord_means <- ord_data %>%
  group_by(language, birth_order, age) %>%
  summarise(median = median(production/n))

fit_ord <- function(x) {
  robustbase::glmrob(cbind(production, no_production) ~
                       age * birth_order  - birth_order,
                     family = "binomial",
                     data = x)
}

pred_ord <- function(x) {
  x$pred <- predict(ord_models[[x$language[1]]],
                    newdata = x, type = "response")
  return(x)
}

ord_models <- ord_data %>%
  split(.$language) %>%
  map(fit_ord)

ord_preds <- expand.grid(language = unique(ord_means$language),
                         age = min_age:max_age,
                         birth_order = unique(ord_means$birth_order)) %>%
  split(.$language) %>%
  map_df(pred_ord)


ggplot(ord_means,
       aes(x = age, y = median, colour = birth_order,
           label = birth_order)) +
  facet_wrap( ~language) +
  geom_point(alpha=.2) +
  geom_line(data = ord_preds, aes(y = pred)) +
  scale_colour_solarized(name="Birth Order") +
  scale_x_continuous(breaks = seq(min(ord_means$age),
                                  max(ord_means$age), 4),
                     limits = c(min(ord_means$age), max(ord_means$age)),
                     name = "Age (months)") +
  ylab("Median Productive Vocabulary (proportion of total words)") +
  ylim(c(0, 1)) +
  theme(legend.position = "bottom")
```

```{r 3b_ord_mmad}
bo_mmad_ratio <- ord_data %>%
  group_by(language, form, age, birth_order) %>%
  filter(n() > 5) %>% # FIXME - arbirtary
  summarise(median_prod = median(production),
            mad_prod = mad(production),
            n = n()) %>%
  group_by(language, form, age) %>%
  filter(sum(birth_order == "First") > 0, 
         sum(birth_order == "Second") > 0) %>% # more than 2 in each gender group
  summarise(mmad = (median_prod[birth_order == "First"] - 
                      median_prod[birth_order == "Second"]) / mean(mad_prod)) %>%
  filter(is.finite(mmad)) 

ggplot(bo_mmad_ratio,
       aes(x = age, y = mmad, col = language)) +
  geom_jitter() +
  geom_smooth(span = 1, aes(group = 1)) +
  scale_color_solarized()
```

Visualize variability. 

```{r}
bo_mmad_summary <- bo_mmad_ratio %>%
  group_by(language) %>%
  summarise(mmad_mean = mean(mmad), 
            mmad_ci_lower = mean(mmad) - ci.t(mmad),
            mmad_ci_upper = mean(mmad) + ci.t(mmad), 
            n = n()) %>%
  filter(n > 4) # more than four age points - FIXME, arbitrary

ggplot(bo_mmad_summary, aes(x = language, y = mmad_mean)) + 
  geom_pointrange(aes(ymin = mmad_ci_lower, ymax = mmad_ci_upper)) + 
  # ylim(0,1.5) + 
  coord_flip() + 
  ylab("Language") + 
  xlab("MMAD") +
  geom_hline(aes(yintercept = 0), lty = 2, color = "gray") + 
  geom_hline(aes(yintercept = 1), lty = 2, color = "gray")
```

Synthesize


```{r}
gender <- gender_mmad_summary %>%
  summarise(cv =  sd(mmad_mean) / mean(mmad_mean))

ses <- ses_mmad_summary %>%
  summarise(cv =  sd(mmad_mean) / mean(mmad_mean))

bo <- bo_mmad_summary %>%
  summarise(cv =  sd(mmad_mean) / mean(mmad_mean))

cvs <- data_frame(measure = c("Female advantage", 
                              "College advantage", 
                              "First-born advantage"), 
                  cv = c(gender$cv, ses$cv, bo$cv))

write_feather(cvs, "data/cvs/demographic_cvs.feather")
```

## ABC method

Another  way to get effect sizes is to integrate the area between curves.

The units for this analysis are arbitrary and (right now) can't be compared across languages, since the curves have different lengths. To overcome this limitation, we'd need to look at

```{r 3_effect_size}
momed_levels <- levels(ses_means$mom_ed)

ses_abc <- ses_preds %>%
  spread(mom_ed, pred) %>%
  group_by(language) %>%
  summarise(mom_secondary_ed = sum(`Secondary` -
                                     `Below Secondary`, na.rm=TRUE),
            mom_college_ed = sum(`College and Above` -
                                   `Secondary`, na.rm=TRUE))

sex_abc <- sex_preds %>%
  spread(sex, pred) %>%
  group_by(language) %>%
  summarise(female = sum(Female - Male, na.rm=TRUE))

ord_abc <- ord_preds %>%
  spread(birth_order, pred) %>%
  group_by(language) %>%
  summarise(firstborn = sum(`First` - `Second`, na.rm=TRUE),
            secondborn = sum(`Second` - `Third+`, na.rm=TRUE))

abcs <- left_join(sex_abc, ord_abc) %>%
  left_join(ses_abc) %>%
  gather(demographic, area_diff, female, firstborn, secondborn,
         mom_secondary_ed, mom_college_ed) %>%
  mutate(demographic = fct_relevel(demographic,
                                   c("female", "firstborn",
                                     "secondborn", "secondary",
                                     "college")))
```

First look at gender advantage.

```{r 3_gender_advantage}
ggplot(filter(abcs, demographic == "female"),
       aes(x = fct_reorder(language, area_diff), y = area_diff)) +
  geom_point() +
  coord_flip() +
  ylab("Advantage for demographic characteristic") +
  xlab("") +
  ylim(c(0, 2.5)) +
  theme(legend.position = "bottom")
```

From this perspective it is quite clear that the Italian effect is anomalous. FIXME: what do we say about this?

Visualizing demographic advantages against one another.

```{r 3_demographic_advantages}
# n_missing <- abcs %>%
#   group_by(language) %>%
#   summarise(n_missing = sum(is.na(area_diff)))

# plot_data <- left_join(abcs, n_missing) %>% 

ggplot(abcs,
       aes(x = language,
           group = demographic, col = demographic,
           y = area_diff)) +
  geom_point() +
  facet_grid(~demographic) + 
  coord_flip() + 
  ylab("Advantage for demographic characteristic") +
  xlab("") +
  ylim(c(0, 4)) +
  theme(legend.position = "bottom")
```

## Are languages truly different, controlling for demographics

We observed that the mena
